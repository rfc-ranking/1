<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFC ë§¤ì¹­ ë¡œë¹„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .pop-in { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 2px; }
        
        /* Select í™”ì‚´í‘œ ì»¤ìŠ¤í…€ */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col pb-10 overflow-hidden">

    <div class="bg-slate-900 border-b border-slate-800 p-3 shadow-md z-50">
        <div class="max-w-[1600px] mx-auto flex flex-col md:flex-row justify-between items-center gap-3">
            <div id="liveStatusBar" class="hidden flex items-center gap-3 bg-red-900/30 px-4 py-2 rounded-full border border-red-500/30">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-red-600"></span>
                </span>
                <span class="font-black italic tracking-wider text-red-100 text-sm">LIVE ON AIR</span>
                <a id="youtubeLink" href="#" target="_blank" class="text-[10px] bg-red-600 text-white px-2 py-0.5 rounded hover:bg-red-500 transition">ì‹œì²­í•˜ê¸° â–¶</a>
            </div>
            
            <div class="flex items-center gap-3 bg-slate-800 px-4 py-2 rounded-xl border border-slate-700">
                <span class="text-xs text-slate-400 font-bold">ë¹„ê³µê°œ ì½”ë“œ</span>
                <span id="roomCodeDisplay" class="text-lg font-mono font-black text-blue-400 tracking-widest">LOADING</span>
                <button onclick="copyRoomCode()" class="text-xs bg-slate-700 text-slate-300 px-2 py-1 rounded hover:bg-slate-600">ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <div class="flex-grow flex flex-col md:flex-row overflow-hidden">
        
        <div class="flex-grow flex flex-col p-4 md:p-6 overflow-hidden bg-slate-900/50">
            
            <div class="mb-6 shrink-0">
                <div id="loginSection" class="bg-slate-800 rounded-2xl p-4 border border-slate-700 flex flex-col md:flex-row gap-3 items-center justify-center max-w-2xl mx-auto shadow-lg hidden">
                    <div class="relative w-full md:w-64">
                        <input type="text" id="loginNameInput" placeholder="ì´ë¦„ ê²€ìƒ‰ (ì´ˆì„± ê°€ëŠ¥)" class="w-full bg-slate-900 border border-slate-600 rounded-xl p-3 text-white focus:border-blue-500 outline-none transition font-bold text-sm" autocomplete="off">
                        <div id="playerDropdown" class="absolute w-full bg-slate-800 border border-slate-600 rounded-xl mt-1 max-h-48 overflow-y-auto z-50 custom-scroll shadow-xl hidden text-left"></div>
                    </div>
                    <input type="password" id="loginPin" placeholder="PIN" class="bg-slate-900 border border-slate-600 rounded-xl p-3 text-white focus:border-blue-500 outline-none transition text-center tracking-[0.5em] font-bold w-24 text-sm" maxlength="4">
                    <button onclick="login()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition text-sm whitespace-nowrap">ë¡œê·¸ì¸</button>
                </div>

                <div id="userPanel" class="bg-slate-800 rounded-2xl p-4 border border-slate-700 flex flex-col md:flex-row items-center justify-between gap-4 max-w-4xl mx-auto shadow-lg hidden">
                    <div class="flex items-center gap-4">
                        <img id="myProfileImg" src="" class="w-14 h-14 rounded-full bg-slate-700 object-cover border-2 border-slate-600">
                        <div>
                            <div id="myDisplayName" class="font-black text-white text-xl">Guest</div>
                            <div class="flex items-center gap-2">
                                <span id="myEloDisplay" class="text-xs text-amber-400 font-bold bg-amber-950/40 px-2 py-0.5 rounded border border-amber-500/20">ELO 1000</span>
                                <button onclick="logout()" class="text-xs text-slate-500 hover:text-white transition underline">ë¡œê·¸ì•„ì›ƒ</button>
                            </div>
                        </div>
                    </div>
                    <button id="createBtn" onclick="createLobby()" class="w-full md:w-auto bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-500 hover:to-blue-500 text-white font-black py-3 px-8 rounded-xl shadow-lg shadow-indigo-900/40 transition transform active:scale-95 flex items-center justify-center gap-2 text-base">
                        <span>ğŸ¥Š</span> ë§¤ì¹˜ ëŒ€ê¸°ë°© ë§Œë“¤ê¸°
                    </button>
                </div>
            </div>

            <div class="flex-grow flex flex-col min-h-0">
                <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center gap-2 px-2 shrink-0">
                    <span>â³</span> ë§¤ì¹­ ëŒ€ê¸°ì¤‘ì¸ ì„ ìˆ˜ë“¤
                    <span id="waitingCount" class="bg-slate-800 text-slate-300 px-2 py-0.5 rounded text-[10px]">0</span>
                </h3>
                <div id="waitingList" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 overflow-y-auto custom-scroll pr-2 pb-20">
                    <div class="col-span-full h-40 flex items-center justify-center text-slate-600 border-2 border-dashed border-slate-800 rounded-2xl">
                        ëŒ€ê¸° ì¤‘ì¸ ë°©ì´ ì—†ìŠµë‹ˆë‹¤. ë°©ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!
                    </div>
                </div>
            </div>
        </div>

        <div class="w-full md:w-80 lg:w-96 bg-slate-900 border-l border-slate-800 flex flex-col shrink-0 h-[300px] md:h-auto border-t md:border-t-0">
            <div class="p-4 bg-slate-900/90 backdrop-blur-sm sticky top-0 z-10 border-b border-slate-800">
                <h3 class="text-sm font-bold text-slate-200 flex items-center gap-2">
                    <span>ğŸ“¡</span> ì‹¤ì‹œê°„ ê²½ê¸° í˜„í™©
                </h3>
            </div>
            
            <div id="statusList" class="flex-grow overflow-y-auto custom-scroll p-4 space-y-3">
                <div class="text-center py-10 text-xs text-slate-600">ì§„í–‰ ì¤‘ì¸ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, runTransaction, getDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDlj68ex-fM0ExRdD-tvCy-UyIneVoPmGk", authDomain: "rfk-ranking.firebaseapp.com", projectId: "rfk-ranking", storageBucket: "rfk-ranking.firebasestorage.app", messagingSenderId: "675366165774", appId: "1:675366165774:web:795d34c56eab630b4dcb5f", measurementId: "G-CXPDZQ8GTL" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const appId = 'ranking-manager-default';
        const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'rankings', 'main');

        let rankingsData = [];
        let matchmakingQueue = [];
        let currentUser = null;

        function getChoseong(str) {
            const cho = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
            let result = "";
            for(let i=0; i<str.length; i++) {
                const code = str.charCodeAt(i) - 44032;
                if(code > -1 && code < 11172) result += cho[Math.floor(code / 588)];
                else result += str.charAt(i);
            }
            return result;
        }

        async function hashPin(pin) {
            if (!pin) return "";
            const msgBuffer = new TextEncoder().encode(pin);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                rankingsData = data.rankings || [];
                rankingsData.forEach(p => { if(p.name) p.choseong = getChoseong(p.name); });

                const info = data.matchInfo || {};
                const queue = data.matchmakingQueue || [];
                matchmakingQueue = queue;

                updateHeaderInfo(info);
                checkLoginStatus(); 
                renderScreen(); // í†µí•© ë Œë”ë§ í•¨ìˆ˜
            }
        });

        // --- ë¡œê·¸ì¸ ê²€ìƒ‰ ---
        const nameInput = document.getElementById('loginNameInput');
        const dropdown = document.getElementById('playerDropdown');

        nameInput.addEventListener('input', (e) => filterAndRenderDropdown(e.target.value.trim()));
        nameInput.addEventListener('focus', () => filterAndRenderDropdown(nameInput.value.trim()));
        document.addEventListener('click', (e) => {
            if (!nameInput.contains(e.target) && !dropdown.contains(e.target)) dropdown.classList.add('hidden');
        });

        function filterAndRenderDropdown(query) {
            dropdown.innerHTML = '';
            const filtered = rankingsData.filter(p => {
                if (!query) return true;
                return p.name.includes(query) || (p.choseong && p.choseong.includes(query));
            }).sort((a, b) => a.name.localeCompare(b.name));

            if (filtered.length === 0) {
                dropdown.innerHTML = '<div class="p-3 text-sm text-slate-500 text-center">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>';
            } else {
                filtered.forEach(p => {
                    const div = document.createElement('div');
                    div.className = 'p-3 hover:bg-slate-700 cursor-pointer border-b border-slate-700 last:border-0 flex justify-between items-center';
                    div.innerHTML = `<span class="font-bold text-slate-200">${p.name}</span> <span class="text-xs text-slate-500">ELO ${p.elo || 1000}</span>`;
                    div.onclick = () => {
                        nameInput.value = p.name;
                        dropdown.classList.add('hidden');
                        document.getElementById('loginPin').focus(); 
                    };
                    dropdown.appendChild(div);
                });
            }
            dropdown.classList.remove('hidden');
        }

        function updateHeaderInfo(info) {
            const liveBar = document.getElementById('liveStatusBar');
            const ytLink = document.getElementById('youtubeLink');
            const codeDisplay = document.getElementById('roomCodeDisplay');
            if (info.isLive) { liveBar.classList.remove('hidden'); ytLink.href = info.url || "#"; } else { liveBar.classList.add('hidden'); }
            codeDisplay.textContent = info.code || "ë¹„ê³µê°œ";
            window.currentRoomCode = info.code || "";
        }

        window.copyRoomCode = () => {
            if(!window.currentRoomCode) return alert("ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");
            navigator.clipboard.writeText(window.currentRoomCode);
            alert("ë°© ì½”ë“œ ë³µì‚¬ë¨: " + window.currentRoomCode);
        }

        window.login = async () => {
            const name = document.getElementById('loginNameInput').value.trim();
            const pin = document.getElementById('loginPin').value.trim();
            if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”.");
            const player = rankingsData.find(p => p.name === name);
            if (!player) return alert("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„ ìˆ˜ì…ë‹ˆë‹¤.");
            const hashed = await hashPin(pin);
            if (player.password !== hashed && player.password !== pin) return alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
            localStorage.setItem('rfc_player_id', player.id);
            checkLoginStatus();
        }

        function checkLoginStatus() {
            const id = localStorage.getItem('rfc_player_id');
            if (id) {
                const player = rankingsData.find(p => p.id === id);
                if (player) {
                    currentUser = player;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('userPanel').classList.remove('hidden');
                    document.getElementById('myDisplayName').textContent = player.name;
                    document.getElementById('myEloDisplay').textContent = `ELO ${player.elo || 1000}`;
                    document.getElementById('myProfileImg').src = player.imageUrl || "https://placehold.co/150?text=No+Img";
                    
                    const myRoom = matchmakingQueue.find(m => m.hostId === currentUser.id && m.status !== 'matched' && m.status !== 'playing');
                    const btn = document.getElementById('createBtn');
                    if (myRoom) {
                        btn.textContent = "ğŸš« ë‚´ ëŒ€ê¸°ë°© ì·¨ì†Œí•˜ê¸°";
                        btn.onclick = () => cancelLobby(myRoom.id);
                        btn.className = "w-full md:w-auto bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-3 px-6 rounded-xl transition text-sm";
                    } else {
                        btn.textContent = "ğŸ¥Š ë§¤ì¹˜ ëŒ€ê¸°ë°© ë§Œë“¤ê¸°";
                        btn.onclick = createLobby;
                        btn.className = "w-full md:w-auto bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-500 hover:to-blue-500 text-white font-black py-3 px-8 rounded-xl shadow-lg shadow-indigo-900/40 transition transform active:scale-95 flex items-center justify-center gap-2 text-base";
                    }
                } else { logout(); }
            } else {
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('userPanel').classList.add('hidden');
                currentUser = null;
            }
        }

        window.logout = () => { localStorage.removeItem('rfc_player_id'); currentUser = null; location.reload(); }

        // --- ë§¤ì¹­ ì•¡ì…˜ ---
        window.createLobby = async () => {
            if (!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            const newMatch = { id: Date.now().toString(), hostId: currentUser.id, hostName: currentUser.name, hostElo: currentUser.elo || 1000, challengerId: null, challengerName: null, status: 'open', timestamp: new Date().toISOString() };
            try { await updateDoc(docRef, { matchmakingQueue: arrayUnion(newMatch) }); } catch(e) { alert("ì˜¤ë¥˜: " + e.message); }
        };
        window.cancelLobby = async (matchId) => {
            const target = matchmakingQueue.find(m => m.id === matchId);
            if (!target) return;
            try { await updateDoc(docRef, { matchmakingQueue: arrayRemove(target) }); } catch(e) { alert("ì˜¤ë¥˜: " + e.message); }
        };
        window.joinLobby = async (matchId) => {
            if (!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            try { await runTransaction(db, async (t) => {
                const doc = await t.get(docRef);
                const q = doc.data().matchmakingQueue || [];
                const idx = q.findIndex(m => m.id === matchId);
                if (idx === -1 || q[idx].status !== 'open') throw "ì°¸ê°€ ë¶ˆê°€";
                q[idx].challengerId = currentUser.id; q[idx].challengerName = currentUser.name; q[idx].challengerElo = currentUser.elo || 1000; q[idx].status = 'pending';
                t.update(docRef, { matchmakingQueue: q });
            }); } catch (e) { alert(e); }
        };
        window.acceptMatch = async (matchId) => {
             try { await runTransaction(db, async (t) => {
                const doc = await t.get(docRef);
                const q = doc.data().matchmakingQueue || [];
                const idx = q.findIndex(m => m.id === matchId);
                if (idx === -1) throw "ì˜¤ë¥˜";
                q[idx].status = 'matched';
                t.update(docRef, { matchmakingQueue: q });
            }); } catch (e) { alert(e); }
        };
        window.startMatch = async (matchId) => {
             try { await runTransaction(db, async (t) => {
                const doc = await t.get(docRef);
                const q = doc.data().matchmakingQueue || [];
                const idx = q.findIndex(m => m.id === matchId);
                if (idx === -1) throw "ì˜¤ë¥˜";
                q[idx].status = 'playing';
                t.update(docRef, { matchmakingQueue: q });
            }); } catch (e) { alert(e); }
        };
        window.rejectMatch = async (matchId) => {
            try { await runTransaction(db, async (t) => {
                const doc = await t.get(docRef);
                const q = doc.data().matchmakingQueue || [];
                const idx = q.findIndex(m => m.id === matchId);
                if (idx === -1) throw "ì˜¤ë¥˜";
                q[idx].challengerId = null; q[idx].challengerName = null; q[idx].status = 'open';
                t.update(docRef, { matchmakingQueue: q });
            }); } catch (e) { alert(e); }
        };

        // --- í†µí•© ë Œë”ë§ í•¨ìˆ˜ ---
        function renderScreen() {
            const waitingContainer = document.getElementById('waitingList');
            const statusContainer = document.getElementById('statusList');
            
            waitingContainer.innerHTML = '';
            statusContainer.innerHTML = '';
            
            const all = matchmakingQueue.filter(m => m.status !== 'closed');
            
            // 1. ë§¤ì¹­ ëŒ€ê¸° (Waiting) - ì¤‘ì•™
            const wait = all.filter(m => m.status === 'open' || m.status === 'pending');
            
            // 2. í˜„í™© ë¦¬ìŠ¤íŠ¸ (Status) - ìš°ì¸¡ ì‚¬ì´ë“œë°”
            // playingì´ ë¨¼ì € ì˜¤ê³ , ê·¸ ë‹¤ìŒ matched(Ready)ê°€ ì˜¤ë„ë¡ ì •ë ¬
            const playing = all.filter(m => m.status === 'playing').sort((a,b) => b.id - a.id);
            const ready = all.filter(m => m.status === 'matched').sort((a,b) => b.id - a.id);
            const statusList = [...playing, ...ready];

            document.getElementById('waitingCount').textContent = wait.length;

            // [Left] Waiting Rendering
            if(wait.length === 0) {
                waitingContainer.innerHTML = `<div class="col-span-full h-40 flex flex-col items-center justify-center text-slate-500 border-2 border-dashed border-slate-700 rounded-2xl bg-slate-800/30 gap-2"><span class="text-2xl opacity-50">ğŸ’¤</span><span>ëŒ€ê¸° ì¤‘ì¸ ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</span></div>`;
            } else {
                wait.forEach(m => {
                    const isHost = currentUser && m.hostId === currentUser.id;
                    const isChallenger = currentUser && m.challengerId === currentUser.id;
                    let html = '';
                    
                    if(m.status === 'pending') {
                        html = `
                            <div class="bg-slate-800 rounded-2xl p-5 border-2 border-blue-500/50 shadow-xl relative pop-in flex flex-col justify-between h-full">
                                <div>
                                    <div class="flex justify-between items-center mb-4">
                                        <div class="flex items-center gap-2">
                                            <span class="relative flex h-2 w-2">
                                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                              <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                                            </span>
                                            <span class="text-blue-400 font-bold text-xs">ìˆ˜ë½ ëŒ€ê¸°ì¤‘</span>
                                        </div>
                                        <span class="text-[10px] text-slate-500">Pending</span>
                                    </div>
                                    <div class="flex justify-between items-center bg-slate-900/50 p-3 rounded-xl mb-4 border border-slate-700">
                                        <div class="text-center w-[45%]">
                                            <div class="text-white font-black text-lg truncate">${m.hostName}</div>
                                            <div class="text-[10px] text-slate-500 font-mono">ELO ${m.hostElo}</div>
                                        </div>
                                        <div class="text-slate-600 font-black text-sm italic">VS</div>
                                        <div class="text-center w-[45%]">
                                            <div class="text-white font-black text-lg truncate">${m.challengerName}</div>
                                            <div class="text-[10px] text-slate-500 font-mono">ELO ${m.challengerElo}</div>
                                        </div>
                                    </div>
                                </div>
                                ${isHost ? `
                                    <div class="flex gap-2 mt-auto">
                                        <button onclick="rejectMatch('${m.id}')" class="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-300 py-3 rounded-xl text-sm font-bold transition">ê±°ì ˆ</button>
                                        <button onclick="acceptMatch('${m.id}')" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl text-sm font-bold transition shadow-lg shadow-blue-500/20">ìˆ˜ë½í•˜ê¸°</button>
                                    </div>
                                ` : (isChallenger ? `
                                    <div class="text-center text-xs text-slate-400 py-3 bg-slate-900/50 rounded-xl animate-pulse mt-auto">ë°©ì¥ì˜ ìˆ˜ë½ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
                                ` : `<div class="text-center text-xs text-slate-500 py-3 mt-auto">ë§¤ì¹­ ì§„í–‰ ì¤‘</div>`)}
                            </div>`;
                    } else { // open
                        html = `
                            <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-sm hover:border-slate-600 transition pop-in flex flex-col justify-between h-full group hover:shadow-lg">
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 rounded-full bg-slate-700 flex items-center justify-center text-2xl shadow-inner border border-slate-600">ğŸ¥Š</div>
                                        <div>
                                            <div class="text-white font-bold text-lg leading-tight group-hover:text-indigo-400 transition">${m.hostName}</div>
                                            <div class="text-xs text-slate-400 mt-0.5 font-mono">ELO ${m.hostElo}</div>
                                        </div>
                                    </div>
                                    <div class="text-xs text-slate-500 mb-4 bg-slate-900/30 p-2 rounded-lg">
                                        ë„ì „ìë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.<br>
                                        <span class="text-slate-600 text-[10px]">ëˆ„êµ¬ë‚˜ ì°¸ì—¬ ê°€ëŠ¥</span>
                                    </div>
                                </div>
                                ${isHost ? `
                                    <button onclick="cancelLobby('${m.id}')" class="w-full text-xs text-red-400 bg-red-900/10 px-3 py-3 rounded-xl border border-red-900/20 hover:bg-red-900/30 transition mt-auto">ëŒ€ê¸°ë°© ì·¨ì†Œ</button>
                                ` : `
                                    <button onclick="joinLobby('${m.id}')" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold px-4 py-3 rounded-xl shadow-lg shadow-indigo-900/20 transition transform active:scale-95 mt-auto flex justify-center items-center gap-2">
                                        <span>âš”ï¸</span> ë„ì „í•˜ê¸°
                                    </button>
                                `}
                            </div>`;
                    }
                    waitingContainer.innerHTML += html;
                });
            }

            // [Right] Status List Rendering
            if(statusList.length === 0) {
                statusContainer.innerHTML = '<div class="text-center py-10 text-xs text-slate-600 border border-dashed border-slate-800 rounded-xl">ì§„í–‰ ì¤‘ì¸ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                statusList.forEach(m => {
                    const isMyMatch = currentUser && (m.hostId === currentUser.id || m.challengerId === currentUser.id);
                    const isHost = currentUser && m.hostId === currentUser.id;
                    const isPlaying = m.status === 'playing';
                    
                    // ìŠ¤íƒ€ì¼ êµ¬ë¶„ (Playing vs Ready)
                    const borderColor = isPlaying ? 'border-red-500/50' : 'border-emerald-500/30';
                    const bgGradient = isPlaying ? 'bg-gradient-to-br from-red-950 to-slate-900' : 'bg-gradient-to-br from-emerald-950 to-slate-900';
                    const badge = isPlaying ? 
                        `<span class="bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded shadow animate-pulse">LIVE</span>` : 
                        `<span class="bg-emerald-500/20 text-emerald-400 text-[9px] font-bold px-2 py-0.5 rounded border border-emerald-500/30">READY</span>`;

                    const html = `
                        <div class="${bgGradient} rounded-xl p-3 border ${borderColor} shadow-lg relative overflow-hidden pop-in">
                            <div class="flex justify-between items-center mb-2">
                                ${badge}
                                ${isHost ? `<button onclick="cancelLobby('${m.id}')" class="text-[9px] text-slate-500 hover:text-slate-300 underline">ì¢…ë£Œ(ì‚­ì œ)</button>` : ''}
                            </div>
                            <div class="flex justify-between items-center px-1 mb-2">
                                <div class="text-center w-[40%]">
                                    <div class="font-bold text-white truncate text-sm">${m.hostName}</div>
                                </div>
                                <div class="text-center font-black text-slate-500 text-xs italic">VS</div>
                                <div class="text-center w-[40%]">
                                    <div class="font-bold text-white truncate text-sm">${m.challengerName}</div>
                                </div>
                            </div>
                            
                            ${isMyMatch ? `
                                <div class="bg-black/30 border border-white/10 rounded-lg p-2 text-center">
                                    ${isPlaying ? 
                                        `<div class="text-xs text-red-200 animate-pulse font-bold">ğŸ”¥ ê²½ê¸° ì§„í–‰ ì¤‘! ğŸ”¥</div>` : 
                                        `<div class="text-[10px] text-slate-400 mb-1">ë¹„ê³µê°œ ë°© ì½”ë“œ</div>
                                         <div class="text-lg font-mono font-black text-white tracking-widest select-all leading-none">${window.currentRoomCode || "CODE"}</div>
                                         ${isHost ? `<button onclick="startMatch('${m.id}')" class="w-full mt-2 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-1.5 rounded text-xs">â–¶ ê²½ê¸° ì‹œì‘</button>` : `<div class="text-[10px] text-emerald-400 mt-1 animate-pulse">í˜¸ìŠ¤íŠ¸ê°€ ê³§ ì‹œì‘í•©ë‹ˆë‹¤...</div>`}
                                        `
                                    }
                                </div>
                            ` : (isPlaying ? `<div class="text-center text-[10px] text-red-400/50 mt-1">Fighting!</div>` : `<div class="text-center text-[10px] text-slate-500 mt-1">ê³§ ê²½ê¸°ê°€ ì‹œì‘ë©ë‹ˆë‹¤.</div>`)}
                        </div>
                    `;
                    statusContainer.innerHTML += html;
                });
            }
        }
    </script>
</body>
</html>
