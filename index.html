<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFC ë­í‚¹ì „ (User)</title> 
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        
        /* ê³µí†µ: ë­í‚¹ ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (1ìœ„ì™€ ë™ì¼í•œ êµ¬ì¡°) */
        /* [ìˆ˜ì •] Hover ì‹œ z-index ìƒìŠ¹ìœ¼ë¡œ íˆ´íŒì´ ìœ— ì¹´ë“œì— ê°€ë ¤ì§€ì§€ ì•Šê²Œ í•¨ */
        .rank-card { position: relative; border-bottom: 1px solid #f1f5f9; transition: all 0.3s; z-index: 1; }
        .rank-card:hover { z-index: 20; transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }

        /* [NEW] ì¸í˜ë¥´ë…¸ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .inferno-card {
            background: linear-gradient(90deg, #1a0505 0%, #2b0b0b 40%, #450a0a 100%);
            border: 1px solid #ef4444;
            /* border-left ì œê±°ë¨ */
            box-shadow: 0 10px 25px -5px rgba(220, 38, 38, 0.4);
            color: white;
        }

        /* [NEW] ë¯¸ë‹ˆ ë¶ˆì”¨ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes ember-mini {
            0% { opacity: 0; transform: translateY(0); }
            50% { opacity: 0.8; }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        .ember-mini { position: absolute; width: 2px; height: 2px; background: #fbbf24; border-radius: 50%; animation: ember-mini 3s infinite; bottom: 5px; }
        
        /* [Inferno Style Animation - Hero] */
        @keyframes ember-rise {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-50px) scale(0); opacity: 0; }
        }
        .ember { position: absolute; width: 4px; height: 4px; background: #fbbf24; border-radius: 50%; animation: ember-rise 4s infinite linear; bottom: -10px; opacity: 0; }


        /* ê¸°ë³¸ í‹°ì–´ ìŠ¤íƒ€ì¼ (4ìœ„ ì´í•˜ ì ìš©) - ì™¼ìª½ í…Œë‘ë¦¬ ì œê±° */
        .tier-bronze, .tier-silver, .tier-gold, .tier-platinum { 
            border-left: none; 
            background: #f8fafc; 
        }
        
        /* [NEW] ì±Œë¦°ì € í‹°ì–´ ìŠ¤íƒ€ì¼ (1300ì  ì´ìƒ) */
        .tier-challenger {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%) !important;
            border: 1px solid #fbbf24 !important;
            border-left: none !important;
            color: white !important;
        }
        .tier-challenger .rank-num-normal, 
        .tier-challenger .font-bold {
            color: #fbbf24 !important; /* í…ìŠ¤íŠ¸ ê¸ˆìƒ‰ ì²˜ë¦¬ */
        }

        /* 1ìœ„ (ì±”í”¼ì–¸ & 1ë“±) ì „ìš© ê¸€ë¡œìš° íš¨ê³¼ */
        .rank-1-glow {
            background: linear-gradient(90deg, #ffffff 30%, #fffbeb 100%) !important;
            box-shadow: 0 10px 25px -5px rgba(234, 179, 8, 0.3), 0 8px 10px -6px rgba(234, 179, 8, 0.2) !important;
            border: 1px solid #fef08a !important; 
            border-left: 5px solid #f59e0b !important;
            z-index: 20 !important;
            transform: scale(1.02);
            color: #1e293b !important;
        }
        
        /* 2nd Place */
        .rank-2-glow {
            background: linear-gradient(120deg, #ffffff 0%, #f8fafc 40%, #e2e8f0 100%) !important;
            box-shadow: 0 10px 25px -5px rgba(148, 163, 184, 0.3), 0 8px 10px -6px rgba(148, 163, 184, 0.1) !important;
            border: 1px solid #cbd5e1 !important;
            border-left: 5px solid #94a3b8 !important;
            z-index: 9 !important;
            color: #1e293b !important;
        }

        /* 3rd Place */
        .rank-3-glow {
            background: linear-gradient(90deg, #ffffff 30%, #fff7ed 100%) !important;
            box-shadow: 0 10px 25px -5px rgba(173, 138, 86, 0.15), 0 8px 10px -6px rgba(173, 138, 86, 0.1) !important;
            border: 1px solid #ffedd5 !important;
            border-left: 5px solid #ad8a56 !important;
            z-index: 8 !important;
            color: #1e293b !important;
        }

        /* ìˆœìœ„ ìˆ«ì ìŠ¤íƒ€ì¼ */
        .rank-num-1 { color: #f59e0b; font-size: 1.5rem !important; font-weight: 900; font-style: italic; letter-spacing: -1px; text-shadow: 0 1px 2px rgba(245, 158, 11, 0.2); }
        .rank-num-2 { color: #64748b; font-size: 1.3rem !important; font-weight: 800; font-style: italic; letter-spacing: -1px; text-shadow: 0 1px 2px rgba(148, 163, 184, 0.2); }
        .rank-num-3 { color: #ad8a56; font-size: 1.2rem !important; font-weight: 800; font-style: italic; letter-spacing: -1px; }
        .rank-num-top10 { color: #047857; font-size: 1.1rem; font-weight: 900; text-shadow: 0 1px 2px rgba(4, 120, 87, 0.15); }
        .rank-num-normal { color: #94a3b8; font-size: 1.0rem; font-weight: 800; }
        .rank-num-unranked { color: #cbd5e1; font-size: 1.0rem; font-weight: 800; }

        /* Rank Change Colors */
        .rank-up { color: #dc2626; font-weight: 800; font-size: 0.75rem; }    /* Red-600 */
        .rank-down { color: #2563eb; font-weight: 800; font-size: 0.75rem; } /* Blue-600 */
        .rank-keep { color: #cbd5e1; font-size: 0.75rem; }

        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { color: #2563eb; border-bottom: 2px solid #2563eb; font-weight: 700; }
        .tab-inactive { color: #64748b; border-bottom: 2px solid transparent; font-weight: 500; }
        .modal-enter { animation: modalSlideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalSlideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .boxrec-win { background: linear-gradient(180deg, #16a34a 0%, #15803d 100%); }
        .boxrec-loss { background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%); }
        .style-checkbox:checked + label { background-color: #3b82f6 !important; color: white !important; border-color: #3b82f6 !important; }

        .color-preset { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; position: relative; }
        .color-preset:hover { transform: scale(1.1); }
        .color-preset.active { border-color: #3b82f6; box-shadow: 0 0 0 2px #fff, 0 0 0 4px #3b82f6; }
        .color-preset.active::after { content: 'âœ”'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 12px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        
        @keyframes slowFade {
            0% { transform: scale(1); background-color: #ffffff; z-index: 20; }
            10% { transform: scale(1.02); background-color: #bfdbfe !important; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5); z-index: 20; border-color: #3b82f6; }
            100% { transform: scale(1); background-color: #ffffff !important; z-index: 1; border-color: #e2e8f0; }
        }
        .highlight-slow { animation: slowFade 10s cubic-bezier(0.22, 1, 0.36, 1) forwards !important; }

        input[type="search"]::-webkit-search-cancel-button {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cline x1='18' y1='6' x2='6' y2='18'%3e%3c/line%3e%3cline x1='6' y1='6' x2='18' y2='18'%3e%3c/line%3e%3c/svg%3e") no-repeat center center;
            cursor: pointer;
            margin-left: 8px;
        }

        /* [INSPECTOR] Z-Index Fix */
        #inspector-tooltip {
            position: fixed; pointer-events: none; 
            z-index: 2147483647 !important; 
            background: rgba(15, 23, 42, 0.95); color: white;
            padding: 8px 12px; border-radius: 8px;
            font-size: 11px; font-family: monospace;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            border: 1px solid #334155;
            transition: opacity 0.1s;
            display: none;
        }
        .tooltip-row { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 2px; }
        .tooltip-label { color: #94a3b8; }
        .tooltip-value { color: #60a5fa; font-weight: bold; }
        
        .active-inspector-btn { background-color: #3b82f6 !important; color: white !important; opacity: 1 !important; }
        .bounty-pill-dark { font-size: 11px; background-color: #1f2937; color: #fbbf24; padding: 1px 5px; border-radius: 4px; margin-left: 3px; font-weight: 800; vertical-align: middle; display: inline-flex; align-items: center; gap: 2px; }

    
        
        /* ì±”í”¼ì–¸ ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        .champ-badge {
            background: linear-gradient(135deg, #fbbf24, #d97706); 
            color: white; 
            border: 1px solid #f59e0b;
            font-size: 10px; padding: 2px 8px; border-radius: 9999px;
            font-weight: 800; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: inline-flex; align-items: center; gap: 2px;
            white-space: nowrap; letter-spacing: 0.05em;
        }
        
        .tooltip-bubble { 
            position: absolute; top: -18px; left: 50%; transform: translateX(-50%); 
            background: #1e293b; color: white; font-size: 7px; padding: 1px 4px; 
            border-radius: 3px; white-space: nowrap; font-weight: bold; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); animation: bounceTooltip 2s infinite; 
            pointer-events: none; z-index: 50;
        }
        .tooltip-bubble::after { 
            content: ''; position: absolute; bottom: -3px; left: 50%; transform: translateX(-50%); 
            border-width: 3px 3px 0; border-style: solid; border-color: #1e293b transparent transparent transparent; 
        }
        .latest-badge { box-shadow: 0 0 0 1.5px white, 0 0 0 3px #3b82f6; z-index: 10; margin-left: 3px !important; }
        @keyframes bounceTooltip {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-2px); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 pb-10 flex flex-col min-h-screen">

    <div id="inspector-tooltip">
        <div class="tooltip-row"><span class="tooltip-label">Tag</span><span class="tooltip-value" id="tt-tag">DIV</span></div>
        <div class="tooltip-row"><span class="tooltip-label">Font</span><span class="tooltip-value" id="tt-font">16px</span></div>
        <div class="tooltip-row"><span class="tooltip-label">Color</span><span class="tooltip-value" id="tt-color">#000</span></div>
        <div class="tooltip-row"><span class="tooltip-label">Class</span><span class="tooltip-value" id="tt-class" style="max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">-</span></div>
    </div>

    <header class="bg-white sticky top-0 z-40 shadow-sm border-b border-slate-200">
        <div class="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="inline-flex flex-col">
                <h1 class="text-xl font-black italic tracking-tighter text-slate-900 leading-none">
                    <span class="text-blue-600">RFC</span> RANKING
                </h1>
                <p class="text-xs text-slate-400 font-medium mt-1 flex gap-2">
                    <span id="currentDate">Loading...</span>
                    <span class="text-slate-300">|</span>
                    <span id="headerVersion">v?.??</span>
                </p>
            </div>
            <div class="flex gap-2 items-center">
                <button onclick="toggleInspector()" id="btnInspector" class="opacity-30 hover:opacity-100 transition-all text-xs font-bold px-2 py-1.5 rounded-lg" title="ìŠ¤íƒ€ì¼ ì¸ìŠ¤í™í„°">ğŸ› ï¸</button>
                <button onclick="openRules()" class="bg-slate-100 text-slate-600 text-xs font-bold px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-200 transition">ğŸ“œ ê·œì¹™</button>
                <div class="relative group">
                    <select id="headerSeasonSelect" class="appearance-none bg-slate-900 text-white text-xs font-bold pl-3 pr-6 py-1.5 rounded-full shadow-lg shadow-slate-500/20 outline-none text-center cursor-pointer transition hover:bg-slate-800">
                        <option value="">Loading...</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-1.5 text-white">
                        <svg class="h-3 w-3 fill-current opacity-80" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>
        </div>
        <nav class="flex border-t border-slate-100 max-w-3xl mx-auto"><button onclick="switchTab('ranking')" id="tabRanking" class="tab-active flex-1 py-3 text-sm transition-colors text-center">ğŸ”¥ ë­í‚¹</button><button onclick="switchTab('matches')" id="tabMatches" class="tab-inactive flex-1 py-3 text-sm transition-colors text-center">âš”ï¸ ê¸°ë¡</button><button onclick="switchTab('hof')" id="tabHof" class="tab-inactive flex-1 py-3 text-sm transition-colors text-center">ğŸ›ï¸ ì „ë‹¹</button><button onclick="switchTab('tournament')" id="tabTournament" class="tab-inactive flex-1 py-3 text-sm transition-colors text-center">ğŸ† ëŒ€ì§„</button></nav>
    </header>

    <main class="max-w-3xl mx-auto p-3 flex-grow w-full">
        <div id="rankingSection" class="fade-in space-y-3">
            <div class="flex justify-between items-center px-1 pb-1 flex-wrap gap-2">
                <span class="text-xs font-bold text-slate-400 hidden sm:block">RFC Season 1: Champions League</span>
                <div class="flex items-center gap-3 w-full sm:w-auto justify-end">
                    <div class="relative flex-grow sm:flex-grow-0">
                        <input type="search" id="playerSearchInput" placeholder="ì„ ìˆ˜/ì´ˆì„± ê²€ìƒ‰" 
                               class="w-full sm:w-[155px] bg-white border border-slate-200 rounded-lg pl-9 pr-2 py-1 text-xs font-bold text-slate-700 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition placeholder-slate-400"
                               readonly
                               onfocus="this.removeAttribute('readonly');"
                               oninput="handleSearch(this.value)">
                        <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs">ğŸ”</div>
                    </div>
                    <div class="flex gap-2 shrink-0">
                        <span class="text-[10px] text-slate-400 bg-white border px-2 py-1 rounded-full"><span class="text-emerald-500">â—</span> ìŠ¹ë¦¬</span>
                        <span class="text-[10px] text-slate-400 bg-white border px-2 py-1 rounded-full"><span class="text-rose-500">â—</span> íŒ¨ë°°</span>
                    </div>
                </div>
            </div>
            <div id="rankingList" class="space-y-2.5"><div class="text-center py-10 text-slate-400 text-sm">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div></div>
        </div>
        
        <div id="matchesSection" class="hidden fade-in space-y-4">
            <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between"><span class="text-sm font-bold text-slate-600">ì‹œì¦Œ ì„ íƒ</span><select id="seasonSelector" class="text-sm font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500"></select></div>
            <div id="matchList" class="space-y-3"></div>
        </div>

        <div id="hofSection" class="hidden fade-in">
            <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between mb-4">
                <span class="text-sm font-bold text-slate-600">ì‹œì¦Œ ì„ íƒ</span>
                <select id="hofSeasonSelector" class="text-sm font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500"></select>
            </div>
            <div id="hofContent" class="space-y-6"></div>
        </div>
        <div id="tournamentSection" class="hidden fade-in"><div id="bracketContainer" class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 overflow-x-auto min-h-[300px] flex items-center justify-center text-slate-400 text-sm">ì§„í–‰ ì¤‘ì¸ í† ë„ˆë¨¼íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div></div>
    </main>

    <footer class="text-center py-8 mt-4 border-t border-slate-200 bg-slate-50">
        <div class="mb-3">
            <span class="text-xs font-black text-slate-400 tracking-widest uppercase">RFC Ranking System</span>
            <span id="displayVersion" class="text-[10px] text-slate-500 font-bold ml-1 bg-white border border-slate-200 px-1.5 py-0.5 rounded shadow-sm">v?.??</span>
        </div>
        <a href="admin.html" class="text-[10px] text-slate-300 hover:text-blue-500 transition-colors font-bold no-underline flex items-center justify-center gap-1">
            <span>ğŸ”’</span> Admin Access
        </a>
    </footer>

    <div id="noticeModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100">
            <div class="bg-indigo-600 p-4 text-white flex justify-between items-center">
                <h3 class="font-bold flex items-center gap-2">
                    <span>ğŸ“¢</span> ì•Œë¦¼
                </h3>
            </div>
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <p id="noticeContent" class="text-sm text-slate-700 whitespace-pre-wrap leading-relaxed">ê³µì§€ ë‚´ìš©</p>
            </div>
            <div class="bg-slate-50 p-4 border-t border-slate-100 flex justify-between items-center">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" id="dontShowToday" class="w-4 h-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                    <span class="ml-2 text-xs text-slate-500 font-medium select-none">ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸°</span>
                </label>
                <button onclick="closeNotice()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg text-xs font-bold transition shadow-sm">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div id="profileModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity" onclick="closeProfile()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.2)] max-w-3xl mx-auto h-[92vh] overflow-y-auto modal-enter flex flex-col">
            <div class="sticky top-0 bg-white/95 backdrop-blur z-10 pt-3 pb-2 flex justify-center cursor-pointer border-b border-slate-100" onclick="closeProfile()"><div class="w-12 h-1.5 bg-slate-200 rounded-full"></div></div>
            <div class="px-5 pb-8 relative mt-2">
                <div class="absolute top-0 right-4 flex gap-3 z-20">
                    <button onclick="requestEdit()" class="text-slate-400 hover:text-blue-600 p-2 text-sm font-bold flex items-center gap-1">âœï¸ìˆ˜ì •</button>
                    <button onclick="closeProfile()" class="text-slate-400 hover:text-slate-600 p-2 text-2xl font-bold">âœ•</button>
                </div>
                <div class="flex flex-col items-center">
                    <div class="text-center mb-4"><h2 class="text-3xl font-black text-slate-800 flex items-center justify-center gap-2 tracking-tight"><span id="pModalCrown" class="text-2xl hidden">ğŸ‘‘</span><span id="pModalName">Name</span></h2><div class="flex items-center justify-center gap-2 mt-1"><span id="pModalGameId" class="text-xs text-slate-500 font-bold bg-slate-100 px-2 py-0.5 rounded">ID: -</span><span id="pModalTierBadge" class="text-[10px] font-bold px-2 py-0.5 rounded bg-slate-400">Tier</span></div></div>
                    <div class="mb-5 relative"><img id="pModalImg" src="" class="w-48 h-48 rounded-2xl object-cover border-4 border-white shadow-xl bg-slate-50" onerror="this.src='https://placehold.co/150?text=No+Img'"></div>
                    <div class="w-full max-w-sm mb-6">
                        <div class="flex justify-end mb-2"><select id="pModalSeason" class="text-xs font-bold text-slate-600 bg-slate-100 border border-slate-200 rounded px-2 py-1 outline-none focus:border-blue-500"><option value="all">ì „ì²´ ê¸°ë¡ (All Time)</option><option value="current">í˜„ì¬ ì‹œì¦Œ (Current)</option></select></div>
                        <div class="flex w-full rounded-lg overflow-hidden shadow-md"><div class="flex-1 boxrec-win text-white p-1.5 text-center border-r border-white/20"><div class="text-3xl font-black leading-none" id="pBigWins">0</div><div class="text-[10px] font-bold opacity-80 uppercase tracking-widest mt-1">Wins</div></div><div class="flex-1 boxrec-loss text-white p-1.5 text-center"><div class="text-3xl font-black leading-none" id="pBigLosses">0</div><div class="text-[10px] font-bold opacity-80 uppercase tracking-widest mt-1">Losses</div></div></div>
                        <div class="flex bg-slate-50 border border-slate-200 border-t-0 rounded-b-lg divide-x divide-slate-200 text-center py-2 shadow-sm"><div class="flex-1"><div class="text-[10px] text-slate-400 font-bold uppercase">Win Rate</div><div class="text-sm font-black text-slate-700" id="pModalWinRate">0%</div></div><div class="flex-1"><div class="text-[10px] text-slate-400 font-bold uppercase">Elo Rating</div><div class="text-sm font-black text-amber-600" id="pModalElo">1000</div></div><div class="flex-1"><div class="text-[10px] text-slate-400 font-bold uppercase">Career High</div><div class="text-sm font-black text-slate-700" id="pModalHighElo">1000</div></div></div>
                    </div>
                    <div class="w-full space-y-6"><div class="bg-white rounded-2xl p-4 border border-slate-100 shadow-sm"><div class="grid grid-cols-3 gap-4 text-center"><div><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">Height</div><div id="pModalHeight" class="font-bold text-slate-700 text-sm">-</div></div><div class="border-x border-slate-100"><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">Reach</div><div id="pModalReach" class="font-bold text-slate-700 text-sm">-</div></div><div><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">Stance</div><div id="pModalStance" class="font-bold text-slate-700 text-sm">-</div></div></div><div id="pModalTags" class="flex flex-wrap gap-1.5 justify-center mt-3"></div></div><div><h3 class="text-xs font-bold text-slate-400 uppercase mb-2 pl-1">Bout History</h3><div id="pModalMatchList" class="space-y-2 pb-10"></div></div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="pinModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-slate-900/80 backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl shadow-xl w-80 text-center">
            <h3 class="text-lg font-bold text-slate-800 mb-2">ğŸ”’ ë³¸ì¸ ì¸ì¦</h3>
            <p class="text-xs text-slate-500 mb-4">í”„ë¡œí•„ ìˆ˜ì •ì„ ìœ„í•´ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br><span class="text-blue-500 font-bold mt-1 inline-block">(ì´ˆê¸° ë¹„ë²ˆì€ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜)</span></p>
            <input type="password" id="inputPin" maxlength="4" class="w-full text-center text-2xl font-bold tracking-[0.5em] border-b-2 border-slate-300 focus:border-blue-500 outline-none pb-2 mb-6" placeholder="â€¢â€¢â€¢â€¢">
            <div class="flex gap-2">
                <button onclick="closePinModal()" class="flex-1 bg-slate-100 text-slate-600 font-bold py-3 rounded-xl text-sm">ì·¨ì†Œ</button>
                <button onclick="checkPin()" class="flex-1 bg-blue-600 text-white font-bold py-3 rounded-xl text-sm">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="userEditModal" class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-slate-900/80 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md h-[90vh] overflow-y-auto p-6 relative">
            <h3 class="text-xl font-bold text-slate-800 mb-6 pb-2 border-b">âœï¸ ë‚´ ì •ë³´ ìˆ˜ì •</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">í”„ë¡œí•„ ì‚¬ì§„ (URL ì£¼ì†Œ)</label>
                    <div class="flex items-start gap-4">
                        <img id="userEditPreview" src="" class="w-16 h-16 rounded-2xl object-cover bg-slate-100 border border-slate-200" onerror="this.src='https://placehold.co/150?text=No+Img'">
                        <div class="flex-grow">
                            <input type="text" id="userImageUrlInput" placeholder="ì´ë¯¸ì§€ ì£¼ì†Œ ë¶™ì—¬ë„£ê¸°" class="w-full border p-3 rounded-xl text-xs font-bold bg-slate-50 focus:bg-white focus:border-blue-500 transition" oninput="updateUserPreview(this.value)">
                            <p class="text-[10px] text-slate-400 mt-1.5">
                                * ë””ìŠ¤ì½”ë“œ/ì¹´í†¡ ë“±ì— ì˜¬ë¦° ì‚¬ì§„ì˜ <strong>ì£¼ì†Œ(URL)</strong>ë¥¼ ë³µì‚¬í•´ ì˜¤ì„¸ìš”.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="text-xs font-bold text-slate-500 mb-2 block">ë°”ì§€ ìƒ‰ìƒ (10ê°€ì§€ í”„ë¦¬ì…‹)</label>
                    <div id="userTrunkColorPresets" class="flex flex-wrap gap-2"></div>
                    <input type="hidden" id="userEditTrunkColor">
                </div>

                <div class="grid grid-cols-2 gap-3"><div><label class="text-xs font-bold text-slate-500 mb-1 block">í‚¤ (cm)</label><input type="text" id="userEditHeight" class="w-full border p-3 rounded-xl text-sm font-bold bg-slate-50"></div><div><label class="text-xs font-bold text-slate-500 mb-1 block">ë¦¬ì¹˜ (cm)</label><input type="text" id="userEditReach" class="w-full border p-3 rounded-xl text-sm font-bold bg-slate-50"></div></div>
                <div><label class="text-xs font-bold text-slate-500 mb-1 block">ìŠ¤íƒ ìŠ¤</label><select id="userEditStance" class="w-full border p-3 rounded-xl text-sm font-bold bg-slate-50"><option value="Orthodox">Orthodox (ì˜¤ë¥¸ì†)</option><option value="Southpaw">Southpaw (ì™¼ì†)</option><option value="Switch">Switch (ì–‘ì†)</option></select></div>
                <div><label class="text-xs font-bold text-slate-500 mb-1 block">Game ID</label><input type="text" id="userEditGameId" class="w-full border p-3 rounded-xl text-sm font-bold bg-slate-50"></div>
                <div><label class="text-xs font-bold text-slate-500 mb-1 block">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ì„ íƒ)</label><input type="text" id="userEditPin" maxlength="4" class="w-full border p-3 rounded-xl text-sm font-bold bg-slate-50" placeholder="ë³€ê²½í•  ê²½ìš°ì—ë§Œ ì…ë ¥ (4ìë¦¬)"></div>
                <div class="p-4 bg-slate-50 rounded-xl border border-slate-100"><label class="text-xs font-bold text-slate-500 mb-2 block">íŒŒì´íŒ… ìŠ¤íƒ€ì¼ (ìµœëŒ€ 3ê°œ)</label><div id="userStyleTags" class="flex flex-wrap gap-2"></div></div>
            </div>
            <div class="flex gap-3 mt-8"><button onclick="closeUserEdit()" class="flex-1 bg-slate-100 text-slate-600 font-bold py-3.5 rounded-xl text-sm">ì·¨ì†Œ</button><button onclick="saveUserProfile()" class="flex-1 bg-blue-600 text-white font-bold py-3.5 rounded-xl text-sm shadow-lg shadow-blue-500/30">ì €ì¥í•˜ê¸°</button></div>
        </div>
    </div>

    <div id="rulesModal" class="fixed inset-0 z-[60] hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeRules()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl w-11/12 max-w-md p-6 max-h-[80vh] overflow-y-auto">
            <h2 class="text-xl font-black text-slate-800 mb-4 border-b pb-2">ğŸ“œ RFC ì ìˆ˜ ì‚°ì • ë°©ì‹</h2>
            <div id="ruleContentArea" class="space-y-5 text-sm text-slate-600">Loading...</div>
            <button onclick="closeRules()" class="w-full mt-6 bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-900 transition">í™•ì¸í–ˆìŠµë‹ˆë‹¤</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, runTransaction } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const USER_CONFIG = {
            version: "v4.94",
            updateNote: "ì±”í”¼ì–¸ ì¹´ë“œ ì™¼ìª½ í…Œë‘ë¦¬ ì œê±°",
            title: "RFC ë­í‚¹ì „"
        };

        function initSystemUI() {
            try {
                document.title = `${USER_CONFIG.title} (${USER_CONFIG.version})`;
                const headerVerEl = document.getElementById('headerVersion');
                if(headerVerEl) headerVerEl.textContent = USER_CONFIG.version;
                const footerVerEl = document.getElementById('displayVersion');
                if(footerVerEl) footerVerEl.textContent = `${USER_CONFIG.version} ${USER_CONFIG.updateNote}`;
            } catch (e) {
                console.warn("System UI Init Failed", e);
            }
        }
        initSystemUI();

        const firebaseConfig = { apiKey: "AIzaSyDlj68ex-fM0ExRdD-tvCy-UyIneVoPmGk", authDomain: "rfk-ranking.firebaseapp.com", projectId: "rfk-ranking", storageBucket: "rfk-ranking.firebasestorage.app", messagingSenderId: "675366165774", appId: "1:675366165774:web:795d34c56eab630b4dcb5f", measurementId: "G-CXPDZQ8GTL" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app); const appId = 'ranking-manager-default';
        let rankingsData = []; let matchHistoryData = []; let enrichedMatchHistory = []; let seasonArchives = {}; let activeSeason = ""; let viewSeason = ""; let viewHofSeason = ""; let viewRankingSeason = ""; let currentProfileId = null;
        let searchQuery = ""; 
        let activeHighlight = { ids: [], endTime: 0 };

        // [New] Inspector State
        let isInspectorActive = false;
        const tooltipEl = document.getElementById('inspector-tooltip');

        window.toggleInspector = () => {
            isInspectorActive = !isInspectorActive;
            const btn = document.getElementById('btnInspector');
            
            if (isInspectorActive) {
                document.body.appendChild(tooltipEl);
                tooltipEl.style.display = 'block'; 
                if(btn) btn.classList.add('active-inspector-btn');
            } else {
                tooltipEl.style.display = 'none';
                if(btn) btn.classList.remove('active-inspector-btn');
            }
        };

        function rgbToHex(rgb) {
            if (!rgb) return '';
            if (rgb.startsWith('#')) return rgb;
            const rgbMatch = rgb.match(/\d+/g);
            if (!rgbMatch) return rgb;
            const r = parseInt(rgbMatch[0]);
            const g = parseInt(rgbMatch[1]);
            const b = parseInt(rgbMatch[2]);
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        document.addEventListener('mousemove', (e) => {
            if (!isInspectorActive) return;
            const target = e.target;
            if (target.closest('#inspector-tooltip') || target.closest('#btnInspector')) return;

            const styles = window.getComputedStyle(target);
            const tag = target.tagName.toLowerCase();
            const fontSize = styles.fontSize;
            const fontWeight = styles.fontWeight;
            const color = styles.color;
            const hexColor = rgbToHex(color);
            const classes = target.className && typeof target.className === 'string' ? target.className.split(' ').slice(0, 2).join('.') : '';

            tooltipEl.style.display = 'block';
            tooltipEl.style.top = (e.clientY + 15) + 'px'; 
            tooltipEl.style.left = (e.clientX + 15) + 'px';
            
            document.getElementById('tt-tag').textContent = tag;
            document.getElementById('tt-font').textContent = `${fontSize} (${fontWeight})`;
            document.getElementById('tt-color').textContent = hexColor;
            document.getElementById('tt-color').style.color = hexColor;
            document.getElementById('tt-class').textContent = classes ? '.' + classes : '-';
        });

        document.addEventListener('mouseout', () => {
            if (isInspectorActive) tooltipEl.style.display = 'none';
        });

        const STYLE_OPTIONS = ["ì¸íŒŒì´í„°", "ì•„ì›ƒë³µì„œ", "ìŠ¬ëŸ¬ê±°", "í•˜ë“œ í€ì²˜", "ë°”ë”” ìŠ¤ë‚´ì²˜", "ë³¼ë¥¨ í€ì²˜", "ìŠ¤ìœ„ì¹˜ íˆí„°", "ë¸Œë¡¤ëŸ¬", "ì¹´ìš´í„° í€ì²˜", "ë³µì„œ-í€ì²˜", "ìŠ¬ë¦­", "ìƒ¤í”„ìŠˆí„°", "íŒ¨ìŠ¤íŠ¸ í•¸ë“œ"];
        
        const COLOR_PRESETS = [
            { name: "Black", code: "#1f2937" }, 
            { name: "Half B/W", code: "linear-gradient(to bottom, #1f2937 50%, #f8fafc 50%)" },
            { name: "White", code: "#f8fafc" }, 
            { name: "Gray", code: "#94a3b8" },
            { name: "Red", code: "#ef4444" }, { name: "Orange", code: "#f97316" }, { name: "Amber", code: "#f59e0b" },
            { name: "Gold", code: "#FFD700" }, { name: "Yellow", code: "#eab308" }, { name: "Lime", code: "#84cc16" }, 
            { name: "Green", code: "#22c55e" }, { name: "Emerald", code: "#10b981" }, { name: "Teal", code: "#14b8a6" }, 
            { name: "Sky", code: "#0ea5e9" }, { name: "Blue", code: "#3b82f6" }, { name: "Indigo", code: "#6366f1" }, 
            { name: "Purple", code: "#a855f7" }, { name: "Fuchsia", code: "#d946ef" }, { name: "Pink", code: "#ec4899" }, 
            { name: "Rose", code: "#f43f5e" }
        ];

        const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'rankings', 'main');
        
        async function hashPin(pin) {
            if (!pin) return "";
            try {
                if (window.crypto && window.crypto.subtle) {
                    const msgBuffer = new TextEncoder().encode(pin);
                    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                } else {
                    return pin;
                }
            } catch (e) {
                return pin;
            }
        }

        const Hangul = {
            CHO: ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"],
            JUNG: ["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"],
            JONG: ["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"],
            COMPLEX_JONG: { 'ã„³':'ã„±ã……', 'ã„µ':'ã„´ã…ˆ', 'ã„¶':'ã„´ã…', 'ã„º':'ã„¹ã„±', 'ã„»':'ã„¹ã…', 'ã„¼':'ã„¹ã…‚', 'ã„½':'ã„¹ã……', 'ã„¾':'ã„¹ã…Œ', 'ã„¿':'ã„¹ã…', 'ã…€':'ã„¹ã…', 'ã…„':'ã…‚ã……' },
            JAMO_MAP: { 'ã„³':'ã„±ã……', 'ã„µ':'ã„´ã…ˆ', 'ã„¶':'ã„´ã…', 'ã„º':'ã„¹ã„±', 'ã„»':'ã„¹ã…', 'ã„¼':'ã„¹ã…‚', 'ã„½':'ã„¹ã……', 'ã„¾':'ã„¹ã…Œ', 'ã„¿':'ã„¹ã…', 'ã…€':'ã„¹ã…', 'ã…„':'ã…‚ã……' },
            getCho: function(str) {
                let result = "";
                for(let i=0; i<str.length; i++) {
                    const code = str.charCodeAt(i) - 44032;
                    if(code > -1 && code < 11172) result += this.CHO[Math.floor(code / 588)];
                    else result += str.charAt(i);
                }
                return result;
            },
            disassemble: function(str) {
                let result = "";
                for (let i = 0; i < str.length; i++) {
                    const char = str.charAt(i);
                    const code = char.charCodeAt(0) - 44032;
                    if (code > -1 && code < 11172) {
                        const choIdx = Math.floor(code / 588);
                        const jungIdx = Math.floor((code - (choIdx * 588)) / 28);
                        const jongIdx = code % 28;
                        const cho = this.CHO[choIdx];
                        const jung = this.JUNG[jungIdx];
                        let jong = this.JONG[jongIdx];
                        if(this.COMPLEX_JONG[jong]) jong = this.COMPLEX_JONG[jong];
                        result += cho + jung + jong;
                    } else {
                        if (this.JAMO_MAP[char]) result += this.JAMO_MAP[char];
                        else result += char;
                    }
                }
                return result;
            }
        };

        function getKSTDate() { return new Date().toLocaleDateString("en-CA", { timeZone: "Asia/Seoul" }); }

        onSnapshot(docRef, (docSnapshot) => {
            if (docSnapshot.exists()) {
                const data = docSnapshot.data(); 
                rankingsData = data.rankings || []; 
                matchHistoryData = data.matchHistory || []; 
                
                // [FIX] ë°ì´í„° ë¡œë“œ ì‹œ ê²½ê¸° ê¸°ë¡ì„ ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ(ìµœì‹ ìˆœ)ìœ¼ë¡œ ê°•ì œ ì •ë ¬
                matchHistoryData.sort((a, b) => new Date(b.date) - new Date(a.date));

                activeSeason = data.activeSeason || "ì‹œì¦Œ 1"; 
                seasonArchives = data.seasonArchives || {};
                
                const ruleArea = document.getElementById('ruleContentArea'); 
                if(ruleArea) { if(data.ruleHtml) ruleArea.innerHTML = data.ruleHtml; else ruleArea.innerHTML = "ê·œì¹™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."; }
                
                if (!viewSeason) viewSeason = activeSeason;
                if (!viewHofSeason) viewHofSeason = activeSeason;
                if (!viewRankingSeason) viewRankingSeason = activeSeason;

                rankingsData.forEach(p => { 
                    if (!p.careerHighElo) p.careerHighElo = p.elo || 1000; 
                    p.choseong = Hangul.getCho(p.name);
                    p.jamo = Hangul.disassemble(p.name);
                    if(p.bounty === undefined) p.bounty = 0;
                }); 
                
                enrichMatchHistory(); 
                updateUI();
                checkNotice(data.noticeData);

                if (currentProfileId) updateProfileStats(currentProfileId, document.getElementById('pModalSeason').value);
            }
        });

        function checkNotice(noticeData) {
            if (!noticeData || !noticeData.active || !noticeData.content) return;
            const today = new Date().toLocaleDateString('en-CA'); 
            const hiddenDate = localStorage.getItem('rfc_notice_hide_date');
            if (hiddenDate === today) return; 
            document.getElementById('noticeContent').textContent = noticeData.content;
            document.getElementById('noticeModal').classList.remove('hidden');
        }

        window.closeNotice = () => {
            const checkBox = document.getElementById('dontShowToday');
            if (checkBox && checkBox.checked) {
                const today = new Date().toLocaleDateString('en-CA');
                localStorage.setItem('rfc_notice_hide_date', today);
            }
            document.getElementById('noticeModal').classList.add('hidden');
        };

        const presetContainer = document.getElementById('userTrunkColorPresets');
        COLOR_PRESETS.forEach(color => {
            const div = document.createElement('div');
            div.className = 'color-preset shadow-sm';
            div.style.background = color.code;
            div.dataset.color = color.code;
            div.title = color.name;
            div.onclick = () => selectUserPresetColor(color.code, div);
            presetContainer.appendChild(div);
        });

        function selectUserPresetColor(code, element) {
            document.getElementById('userEditTrunkColor').value = code;
            document.querySelectorAll('#userEditModal .color-preset').forEach(el => el.classList.remove('active'));
            if(element) element.classList.add('active');
        }

        function enrichMatchHistory() { 
            const chronological = [...matchHistoryData].reverse(); 
            const allTimeTracker = {}; 
            const seasonTracker = {}; 
            
            enrichedMatchHistory = chronological.map(match => { 
                const winner = match.winner; 
                const loser = match.loser; 
                const season = match.season || "ì‹œì¦Œ 1";

                if (!allTimeTracker[winner]) allTimeTracker[winner] = { w: 0, l: 0, h: [] };
                if (!allTimeTracker[loser]) allTimeTracker[loser] = { w: 0, l: 0, h: [] };
                
                if (!seasonTracker[season]) seasonTracker[season] = {};
                if (!seasonTracker[season][winner]) seasonTracker[season][winner] = { w: 0, l: 0, h: [] };
                if (!seasonTracker[season][loser]) seasonTracker[season][loser] = { w: 0, l: 0, h: [] };

                const snapshot = { 
                    all: { [winner]: { ...allTimeTracker[winner] }, [loser]: { ...allTimeTracker[loser] } },
                    season: { [winner]: { ...seasonTracker[season][winner] }, [loser]: { ...seasonTracker[season][loser] } }
                };
                
                if (match.type !== 'draw') { 
                    allTimeTracker[winner].w++; allTimeTracker[winner].h = [...allTimeTracker[winner].h, 'W'].slice(-6); 
                    allTimeTracker[loser].l++; allTimeTracker[loser].h = [...allTimeTracker[loser].h, 'L'].slice(-6); 
                    seasonTracker[season][winner].w++; seasonTracker[season][winner].h = [...seasonTracker[season][winner].h, 'W'].slice(-6);
                    seasonTracker[season][loser].l++; seasonTracker[season][loser].h = [...seasonTracker[season][loser].h, 'L'].slice(-6);
                } 
                return { ...match, snapshot }; 
            }); 
            enrichedMatchHistory.reverse(); 
        }

        function updateUI() { 
            const now = new Date(); 
            const dateStr = now.toLocaleDateString('en-CA').replace(/-/g, '.');
            document.getElementById('currentDate').textContent = dateStr; 
            updateHeaderSeasonSelector(); renderRankings(); updateSeasonSelector(); updateHofSeasonSelector(); renderMatches(); renderHOF(); 
        }
        
        function getTier(wins, losses, elo = 0, isChampion = false) { 
            if (isChampion) {
                return { 
                    name: 'CHAMPION', 
                    class: 'tier-champion', 
                    color: 'bg-gradient-to-r from-yellow-400 to-amber-500 text-white border border-yellow-600 shadow-md' 
                };
            }
            if (elo >= 1300) {
                return { 
                    name: 'CHALLENGER', 
                    class: 'tier-challenger', 
                    color: 'bg-slate-900 border border-amber-400 text-amber-400 shadow-md ring-1 ring-amber-400/30' 
                };
            }
            const matches = (wins || 0) + (losses || 0); 
            if (matches < 3) return { name: 'BRONZE', class: 'tier-bronze', color: 'bg-white border border-amber-600 text-amber-700' }; 
            if (matches < 7) return { name: 'SILVER', class: 'tier-silver', color: 'bg-white border border-slate-400 text-slate-500' }; 
            if (matches < 13) return { name: 'GOLD', class: 'tier-gold', color: 'bg-white border border-yellow-500 text-yellow-600' }; 
            return { name: 'PLATINUM', class: 'tier-platinum', color: 'bg-white border border-cyan-500 text-cyan-600' }; 
        }
        
        window.handleSearch = (val) => {
            searchQuery = val.trim().toLowerCase();
            renderRankings();
        };

        function isRecentRankIn(dateStr) {
            if (!dateStr) return false;
            const today = new Date(getKSTDate());
            const rankIn = new Date(dateStr);
            const diffTime = today - rankIn;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays <= 2; 
        }

        // [ìˆ˜ì •] ìµœê·¼ ê²½ê¸° ì „ì  í‘œì‹œ (ë°•ìŠ¤ -> ì  í˜•íƒœ ë³€ê²½)
        function getRecentFormHTML(name) {
            const targetSeason = viewRankingSeason || activeSeason;
            
            // í•´ë‹¹ ì„ ìˆ˜ì˜ ê²½ê¸° ê¸°ë¡ ê°€ì ¸ì˜¤ê¸° (ë¬´ìŠ¹ë¶€ ì œì™¸)
            const history = enrichedMatchHistory.filter(m => 
                (m.winner === name || m.loser === name) && 
                m.type !== 'draw' &&
                m.season === targetSeason
            );
            
            // ìµœê·¼ 6ê²½ê¸° ì¶”ì¶œ í›„ ê³¼ê±°->ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬
            const recent = history.slice(0, 6).reverse(); 
            
            if (recent.length === 0) return '';

            // ì  í˜•íƒœ ì»¨í…Œì´ë„ˆ (gap-1ë¡œ ê°„ê²© ì¡°ì •)
            let html = '<div class="flex items-center gap-1">'; 
            
            recent.forEach((m) => {
                const isWin = m.winner === name;
                // ìŠ¹ë¦¬: ì—ë©”ë„ë“œ, íŒ¨ë°°: ë¡œì¦ˆ (í”„ë¡œí•„ ì¹´ë“œ ë‚´ë¶€ì™€ ë™ì¼ ìƒ‰ìƒ)
                // í¬ê¸°ëŠ” w-1.5 h-1.5 (6px)ë¡œ ì„¤ì •í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ì—ì„œë„ ì˜ ë³´ì´ê²Œ í•¨
                const colorClass = isWin ? 'bg-emerald-400' : 'bg-rose-400';
                
                html += `<div class="w-1.5 h-1.5 rounded-full ${colorClass}"></div>`;
            });
            
            html += '</div>';
            return html;
        }

        function renderRankings() { 
            const container = document.getElementById('rankingList'); container.innerHTML = ''; 
            let fullData = [];
            if (viewRankingSeason === activeSeason) {
                fullData = [...rankingsData];
            } else {
                fullData = [...(seasonArchives[viewRankingSeason]?.rankings || [])];
                fullData.forEach(p => {
                    if(!p.choseong) p.choseong = Hangul.getCho(p.name);
                    if(!p.jamo) p.jamo = Hangul.disassemble(p.name);
                });
            }

            fullData.sort((a, b) => (b.elo || 1000) - (a.elo || 1000));

            const champion = fullData.find(p => p.isChampion);
            const globalChallengers = fullData.filter(p => !p.isChampion);

            let displayList = fullData;
            if (searchQuery) {
                const queryJamo = Hangul.disassemble(searchQuery.replace(/\s/g, ""));
                const qClean = searchQuery.replace(/\s/g, "");
                displayList = fullData.filter(p => {
                    const name = p.name || "";
                    const nameClean = name.replace(/\s/g, "").toLowerCase();
                    if (nameClean.includes(qClean)) return true;
                    if (p.choseong && (p.choseong.includes(qClean) || p.choseong.includes(queryJamo))) return true;
                    if (p.jamo && p.jamo.includes(queryJamo)) return true;
                    return false;
                });
            }

            const showChampion = champion && displayList.find(p => p.id === champion.id);
            const ranked = displayList.filter(p => !p.isChampion && (Number(p.wins||0)+Number(p.losses||0)) >= 3)
                                      .sort((a, b) => (b.elo || 1000) - (a.elo || 1000));
            
            const placement = displayList.filter(p => !p.isChampion && ((Number(p.wins||0)+Number(p.losses||0)) > 0 && (Number(p.wins||0)+Number(p.losses||0)) < 3))
                                         .sort((a, b) => (b.elo || 1000) - (a.elo || 1000));
                                         
            const unranked = displayList.filter(p => !p.isChampion && (Number(p.wins||0)+Number(p.losses||0)) === 0)
                                        .sort((a, b) => (b.elo || 1000) - (a.elo || 1000));

            const now = Date.now();
            const shouldHighlight = (id) => activeHighlight.ids.includes(id) && now < activeHighlight.endTime;

            if (displayList.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-slate-400 text-sm">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            // --- [CHAMPION SECTION] STYLE 4: CROWN BADGE (List Layout) ---
            if (showChampion) {
                const p = champion;
                const defCount = p.defenseCount || 0;
                const formHtml = getRecentFormHTML(p.name);
                
                // ì—°ìŠ¹ HTML
                let streakHtml = '';
                if ((p.currentStreak || 0) >= 3) {
                    streakHtml = `<span class="ml-1 text-[10px] text-orange-400 font-bold">ğŸ”¥${p.currentStreak}ì—°ìŠ¹</span>`;
                }

                container.innerHTML += `
                <div class="rank-card flex items-center p-3 md:p-4 rounded-xl mb-2 inferno-card relative group cursor-pointer" onclick="openProfile('${p.id}')">
                    <!-- Background Container for clipping effects -->
                    <div class="absolute inset-0 overflow-hidden rounded-xl">
                         <div class="ember-mini" style="left: 20%; animation-delay: 0s;"></div>
                         <div class="ember-mini" style="left: 80%; animation-delay: 1.5s;"></div>
                    </div>

                    <!-- Rank Section (Crown Badge) -->
                    <div class="w-10 text-center mr-2 flex flex-col items-center justify-center shrink-0 relative z-10">
                        <div class="text-2xl drop-shadow-md">ğŸ‘‘</div>
                        <span class="text-[8px] font-bold text-orange-200 uppercase tracking-wide bg-orange-900/50 px-1 rounded border border-orange-500/30 -mt-1">CHAMP</span>
                    </div>

                    <!-- Image Section (Same as Rank 1) -->
                    <div class="shrink-0 relative mr-3 -my-2 md:-my-4 relative z-10">
                        <img src="${p.imageUrl || 'https://placehold.co/150/f59e0b/white?text=C'}" 
                             class="w-[60px] h-[60px] md:w-[90px] md:h-[90px] rounded-2xl bg-slate-900 object-cover border-2 border-orange-300/30 shadow-lg"
                             onerror="this.src='https://placehold.co/150/f59e0b/white?text=C'">
                    </div>

                    <!-- Info Section -->
                    <div class="flex-grow min-w-0 flex flex-col justify-center py-1 relative z-10">
                        <!-- ë±ƒì§€ ë³µì› ìœ„ì¹˜: ë‹‰ë„¤ì„ ìƒë‹¨ -->
                        <div class="flex items-center gap-2 mb-1">
                             <div class="champ-badge">CHAMPION</div>
                        </div>

                        <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1.5">
                            <div class="w-1.5 h-4 rounded-sm shadow-sm ring-1 ring-inset ring-white/20" style="background: #fbbf24;"></div>
                            <span class="font-bold text-white truncate text-sm md:text-lg">${p.name}</span>
                            ${streakHtml}
                        </div>
                        <div class="flex items-center gap-1.5 mt-0.5">
                            <span class="bg-black/40 text-orange-300 text-[10px] px-1.5 py-0.5 rounded border border-orange-500/30 font-bold">âš¡${p.elo}</span>
                            <span class="text-xs text-slate-300">| ${p.wins}ìŠ¹ ${p.losses}íŒ¨</span>
                            <span class="bg-orange-950/50 text-orange-300 border border-orange-500/30 text-[10px] px-1.5 py-0.5 rounded font-bold ml-1">ğŸ›¡ï¸ ${defCount}ì°¨ ë°©ì–´</span>
                        </div>
                    </div>

                    <!-- Form Section -->
                    <div class="flex flex-col items-end justify-center shrink-0 md:h-full relative z-10">
                        <div class="flex gap-1 p-1 md:p-1.5">
                            ${formHtml}
                        </div>
                    </div>
                </div>`;
            } else {
                // ì±”í”¼ì–¸ ê³µì„ ì‹œ í‘œì‹œ (ì‹¤ë£¨ì—£ ëª¨ë“œ - ë¦¬ìŠ¤íŠ¸í˜•)
                container.innerHTML += `
                <div class="rank-card flex items-center p-3 md:p-4 rounded-xl mb-2 bg-slate-900/90 border border-slate-700 relative overflow-hidden opacity-90">
                    <!-- Rank Section -->
                    <div class="w-10 text-center mr-2 flex flex-col items-center justify-center shrink-0 opacity-50">
                        <div class="text-xl grayscale">ğŸ‘‘</div>
                        <span class="text-[8px] font-bold text-slate-500 uppercase tracking-wide -mt-1">VACANT</span>
                    </div>

                    <!-- Image Section -->
                    <div class="shrink-0 relative mr-3 -my-2 md:-my-4">
                        <div class="w-[60px] h-[60px] md:w-[90px] md:h-[90px] rounded-2xl bg-slate-800 border border-slate-700 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Info Section -->
                    <div class="flex-grow min-w-0 flex flex-col justify-center py-1">
                        <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1.5">
                            <span class="font-bold text-slate-500 truncate text-sm md:text-lg">ê³µì„ (No Champion)</span>
                        </div>
                        <div class="flex items-center gap-1.5 mt-0.5">
                            <span class="text-xs text-slate-600">ìƒˆë¡œìš´ ì±”í”¼ì–¸ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</span>
                        </div>
                    </div>
                </div>`;
            }

            // --- [LIST SECTION] ë„ì „ì (1ìˆœìœ„ ~) ---
            ranked.forEach((item) => { 
                const globalIndex = rankingsData.indexOf(item); 
                const realRank = globalChallengers.findIndex(gp => gp.id === item.id) + 1;
                const tier = getTier(item.wins, item.losses, item.elo, false); 
                const totalMatches = (item.wins || 0) + (item.losses || 0);
                const formHtml = getRecentFormHTML(item.name);
                
                let cardClass = tier.class;
                let rankNumClass = "rank-num-normal";
                
                if (realRank === 1) { 
                    rankNumClass = "rank-num-1"; 
                    cardClass = 'rank-1-glow';
                } 
                else if (realRank === 2) { 
                    rankNumClass = "rank-num-2"; 
                    cardClass = 'rank-2-glow'; 
                } 
                else if (realRank === 3) { 
                    rankNumClass = "rank-num-3"; 
                    cardClass = 'rank-3-glow'; 
                } 
                else { 
                    if (realRank <= 10) rankNumClass = "rank-num-top10"; 
                }

                let streakHtml = '';
                if ((item.currentStreak || 0) >= 3) {
                    streakHtml = `<span class="ml-1 text-[10px] text-orange-600 font-bold">ğŸ”¥${item.currentStreak}ì—°ìŠ¹</span>`;
                }

                let bountyStatHtml = '';
                // [ìˆ˜ì •] 1~10ìœ„ ê¹Œì§€ë§Œ í˜„ìƒê¸ˆ ë±ƒì§€ í‘œì‹œ (ì‚¬ìš©ì ì‚¬ì´íŠ¸ ì ìš©)
                if (item.bounty && item.bounty > 0 && realRank <= 10) {
                      bountyStatHtml = `<span class="bounty-pill-dark" title="í˜„ìƒê¸ˆ">ğŸ’°+${item.bounty}</span>`;
                }

                const prevRank = item.previousRank || realRank; 
                const diff = prevRank - realRank; 
                let diffHtml = ""; 
                if (totalMatches === 3 && isRecentRankIn(item.rankInDate)) {
                      diffHtml = `<span class="text-indigo-600 font-black text-[10px] bg-indigo-50 px-1.5 py-0.5 rounded border border-indigo-100 animate-pulse">New</span>`;
                } else {
                      diffHtml = diff > 0 ? `<span class="rank-up">â–²${diff}</span>` : (diff < 0 ? `<span class="rank-down">â–¼${Math.abs(diff)}</span>` : '<span class="rank-keep">-</span>');
                }
                
                if (shouldHighlight(item.id)) cardClass += ' highlight-slow';

                container.innerHTML += `
                    <div id="rank-card-${item.id}" class="rank-card flex items-center p-3 md:p-4 border rounded-xl mb-2 bg-white hover:shadow-md ${cardClass}" onclick="openProfile('${item.id}')">
                        <div class="w-10 text-center mr-2"><span class="${rankNumClass}">${realRank}</span><div class="text-[10px]">${diffHtml}</div></div>
                        <div class="shrink-0 relative mr-3 -my-2 md:-my-4">
                            <img src="${item.imageUrl || 'https://placehold.co/150?text=No+Img'}" class="w-[60px] h-[60px] md:w-[90px] md:h-[90px] rounded-2xl bg-slate-100 object-cover border border-slate-100" onerror="this.src='https://placehold.co/150?text=No+Img'">
                        </div>
                        <div class="flex-grow min-w-0 flex flex-col justify-center py-1">
                            <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1.5">
                                <div class="w-1.5 h-4 rounded-sm shadow-sm ring-1 ring-inset ring-black/10" style="background: ${item.trunkColor || '#1f2937'};" title="íŠ¸ë í¬ ìƒ‰ìƒ"></div>
                                <span class="font-bold text-slate-800 truncate text-sm md:text-lg">${item.name}</span>
                                <span class="text-[9px] px-1.5 py-0.5 rounded-full ${tier.color} font-bold tracking-wide uppercase shadow-sm">${tier.name}</span>
                                ${streakHtml}
                            </div>
                            <div class="flex items-center gap-1.5 mt-0.5">
                                <span class="bg-amber-100 text-amber-800 text-[10px] px-1.5 py-0.5 rounded border border-amber-200 font-bold">âš¡${item.elo}</span>
                                <span class="text-xs text-slate-400">| ${item.wins}ìŠ¹ ${item.losses}íŒ¨</span>
                                ${bountyStatHtml} 
                            </div>
                        </div>
                        <div class="flex flex-col items-end justify-center shrink-0 md:h-full">
                            <div class="flex gap-1 p-1 md:p-1.5">
                                ${formHtml}
                            </div>
                        </div>
                    </div>`; 
            }); 

            if (placement.length > 0) {
                container.innerHTML += `
                    <div class="relative py-4">
                        <div class="absolute inset-0 flex items-center" aria-hidden="true">
                            <div class="w-full border-t border-slate-200"></div>
                        </div>
                        <div class="relative flex justify-center">
                            <span class="bg-[#f8fafc] px-3 text-xs font-bold text-slate-400">ğŸ£ ë°°ì¹˜ê³ ì‚¬ ì§„í–‰ì¤‘ (3ê²½ê¸°)</span>
                        </div>
                    </div>`;

                placement.forEach((p) => {
                    const highlightClass = shouldHighlight(p.id) ? 'highlight-slow' : '';
                    
                    container.innerHTML += `
                        <div id="rank-card-${p.id}" class="rank-card flex items-center p-3 md:p-4 border rounded-xl mb-2 bg-slate-50 opacity-90 hover:opacity-100 ${highlightClass}" onclick="openProfile('${p.id}')">
                            <div class="w-10 text-center mr-2"><span class="text-lg md:text-xl">ğŸ£</span></div>
                            <div class="shrink-0 relative mr-3 -my-2 md:-my-4">
                                <img src="${p.imageUrl ? p.imageUrl : 'https://placehold.co/150?text=No+Img'}" 
                                     class="w-[60px] h-[60px] md:w-[90px] md:h-[90px] rounded-2xl bg-slate-100 object-cover border border-slate-100 md:border-2 md:border-slate-50 shadow-sm transition-all duration-300" 
                                     onerror="this.src='https://placehold.co/150?text=No+Img'">
                            </div>
                            <div class="flex-grow min-w-0 flex flex-col justify-center py-1">
                                <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1.5">
                                    <div class="w-1.5 h-4 rounded-sm shadow-sm ring-1 ring-inset ring-black/10" style="background: ${p.trunkColor || '#1f2937'};" title="íŠ¸ë í¬ ìƒ‰ìƒ"></div>
                                    <span class="font-bold text-slate-600 truncate text-sm md:text-lg">${p.name}</span>
                                    <span class="text-[9px] px-1.5 py-0.5 rounded-full bg-slate-100 text-slate-500 border border-slate-200 font-bold tracking-wide uppercase shadow-sm">Placement</span>
                                </div>
                                <div class="flex items-center gap-1.5 mt-0.5">
                                    <span class="bg-amber-50 text-amber-600/70 text-[10px] px-1.5 py-0.5 rounded border border-amber-100 font-bold">âš¡${p.elo || 1000} (ì„ì‹œ)</span>
                                    <span class="text-xs text-slate-400">| ${p.wins}ìŠ¹ ${p.losses}íŒ¨</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end justify-center shrink-0 md:h-full"></div>
                        </div>`;
                });
            }

            if(unranked.length > 0) {
                container.innerHTML += `
                    <div class="relative py-4">
                        <div class="absolute inset-0 flex items-center" aria-hidden="true">
                            <div class="w-full border-t border-slate-200"></div>
                        </div>
                        <div class="relative flex justify-center">
                            <span class="bg-[#f8fafc] px-3 text-xs font-bold text-slate-300">- Unranked Players -</span>
                        </div>
                    </div>`;

                unranked.forEach((p) => {
                    const highlightClass = shouldHighlight(p.id) ? 'highlight-slow' : '';
                    
                    container.innerHTML += `
                        <div class="bg-white rounded-2xl p-3 md:p-4 shadow-sm border border-slate-100 flex items-center gap-3 relative overflow-hidden transition-transform active:scale-[0.99] cursor-pointer opacity-80 ${highlightClass}" onclick="openProfile('${p.id}')">
                            <div class="flex flex-col items-center justify-center w-8 md:w-10 shrink-0"><span class="rank-unranked">-</span></div>
                            <div class="shrink-0 relative mr-3 -my-2 md:-my-4">
                                <img src="${p.imageUrl ? p.imageUrl : 'https://placehold.co/150?text=No+Img'}" 
                                     class="w-[60px] h-[60px] md:w-[90px] md:h-[90px] rounded-2xl bg-slate-100 object-cover border border-slate-100 md:border-2 md:border-slate-50 grayscale shadow-sm transition-all duration-300" 
                                     onerror="this.src='https://placehold.co/150?text=No+Img'">
                            </div>
                            <div class="flex-grow min-w-0 flex flex-col justify-center py-1">
                                <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1.5">
                                    <div class="w-1.5 h-4 rounded-sm shadow-sm ring-1 ring-inset ring-black/10" style="background: ${p.trunkColor || '#1f2937'};" title="íŠ¸ë í¬ ìƒ‰ìƒ"></div>
                                    <span class="font-bold text-slate-500 truncate text-sm md:text-lg">${p.name}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="bg-slate-100 text-slate-400 text-[10px] px-1.5 md:px-2 py-0.5 rounded border border-slate-200 font-bold">New Challenger</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end justify-center shrink-0 md:h-full"></div>
                        </div>`;
                });
            }
        }

        function updateHeaderSeasonSelector() {
            const selector = document.getElementById('headerSeasonSelect');
            if (!selector) return;
            selector.innerHTML = '';
            
            const opts = [activeSeason, ...Object.keys(seasonArchives).sort().reverse().filter(s => s !== activeSeason)];
            
            opts.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s + (s === activeSeason ? " ğŸŸ¢" : "");
                selector.appendChild(opt);
            });
            
            selector.value = viewRankingSeason;
            
            selector.onchange = (e) => {
                const newSeason = e.target.value;
                viewRankingSeason = newSeason;
                viewSeason = newSeason;
                viewHofSeason = newSeason;
                
                const matchesSelect = document.getElementById('seasonSelector');
                if(matchesSelect) matchesSelect.value = newSeason;
                
                const hofSelect = document.getElementById('hofSeasonSelector');
                if(hofSelect) hofSelect.value = newSeason;

                renderRankings();
                renderMatches(); 
                renderHOF();
            };
        }

        function updateSeasonSelector() { 
            const selector = document.getElementById('seasonSelector'); 
            selector.innerHTML = ''; 
            const opts = [activeSeason, ...Object.keys(seasonArchives).sort().reverse().filter(s => s !== activeSeason)]; 
            opts.forEach(s => { 
                const opt = document.createElement('option'); 
                opt.value = s; 
                opt.textContent = s + (s === activeSeason ? " ğŸŸ¢" : ""); 
                selector.appendChild(opt); 
            }); 
            selector.value = viewSeason; 
            selector.onchange = (e) => { viewSeason = e.target.value; renderMatches(); }; 
        }

        function updateHofSeasonSelector() { 
            const selector = document.getElementById('hofSeasonSelector'); 
            selector.innerHTML = ''; 
            const opts = [activeSeason, ...Object.keys(seasonArchives).sort().reverse().filter(s => s !== activeSeason)]; 
            opts.forEach(s => { 
                const opt = document.createElement('option'); 
                opt.value = s; 
                opt.textContent = s + (s === activeSeason ? " ğŸŸ¢" : ""); 
                selector.appendChild(opt); 
            }); 
            selector.value = viewHofSeason; 
            selector.onchange = (e) => { viewHofSeason = e.target.value; renderHOF(); }; 
        }

        function renderMatches() { 
            const container = document.getElementById('matchList'); 
            container.innerHTML = ''; 
            const filtered = enrichedMatchHistory.filter(m => (m.season || "ì‹œì¦Œ 1") === viewSeason && m.type !== 'draw'); 
            
            if (filtered.length === 0) { 
                container.innerHTML = `<div class="text-center py-10 text-slate-400 text-sm">ê¸°ë¡ëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`; 
                return; 
            } 

            const dateCounts = filtered.reduce((acc, m) => {
                acc[m.date] = (acc[m.date] || 0) + 1;
                return acc;
            }, {});

            let lastDate = "";
            
            filtered.forEach(m => { 
                const winStats = m.snapshot.season ? m.snapshot.season[m.winner] : (m.snapshot[m.winner] || { w:0, l:0, h:[] });
                const loseStats = m.snapshot.season ? m.snapshot.season[m.loser] : (m.snapshot[m.loser] || { w:0, l:0, h:[] });
                
                const winProfile = rankingsData.find(p => p.name === m.winner);
                const loseProfile = rankingsData.find(p => p.name === m.loser);
                const winClick = winProfile ? `onclick="openProfile('${winProfile.id}')"` : '';
                const loseClick = loseProfile ? `onclick="openProfile('${loseProfile.id}')"` : '';
                const cursorStyle = (profile) => profile ? "cursor-pointer hover:underline hover:text-blue-700" : "";
                
                let winDots = ''; (winStats.h || []).forEach(r => winDots += `<div class="w-1.5 h-1.5 rounded-full ${r==='W'?'bg-emerald-400':'bg-rose-400'}"></div>`);
                let loseDots = ''; (loseStats.h || []).forEach(r => loseDots += `<div class="w-1.5 h-1.5 rounded-full ${r==='W'?'bg-emerald-400':'bg-rose-400'}"></div>`);
                
                if (m.date !== lastDate) {
                    const count = dateCounts[m.date];
                    const dateHeader = document.createElement('div');
                    dateHeader.className = "text-sm font-bold text-slate-500 mt-6 mb-2 px-1 flex items-center gap-1";
                    dateHeader.innerHTML = `<span>ğŸ“…</span> ${m.date} <span class="text-slate-400 font-normal text-xs ml-1">(ì´ ${count}ê²½ê¸°)</span>`;
                    container.appendChild(dateHeader);
                    lastDate = m.date;
                }

                const div = document.createElement('div'); 
                div.className = "bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col gap-3"; 
                div.innerHTML = `
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex flex-col items-start w-[45%] ${cursorStyle(winProfile)}" ${winClick}>
                            <div class="flex items-center gap-1.5">
                                <span class="text-sm font-black text-slate-800 truncate">${m.winner}</span>
                                <span class="bg-emerald-100 text-emerald-600 text-[9px] px-1 py-0.5 rounded font-bold">WIN</span>
                            </div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-[9px] text-slate-400 font-medium bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100">${winStats.w}ìŠ¹ ${winStats.l}íŒ¨</span>
                                <div class="flex gap-0.5">${winDots}</div>
                            </div>
                        </div>
                        <div class="text-xs font-bold text-slate-300">VS</div>
                        <div class="flex flex-col items-end w-[45%] ${cursorStyle(loseProfile)}" ${loseClick}>
                            <div class="flex items-center gap-1.5">
                                <span class="bg-rose-100 text-rose-600 text-[9px] px-1 py-0.5 rounded font-bold">LOSE</span>
                                <span class="text-sm font-medium text-slate-500 truncate">${m.loser}</span>
                            </div>
                             <div class="flex items-center gap-2 mt-1">
                                <div class="flex gap-0.5">${loseDots}</div>
                                <span class="text-[9px] text-slate-400 font-medium bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100">${loseStats.w}ìŠ¹ ${loseStats.l}íŒ¨</span>
                            </div>
                        </div>
                    </div>`; 
                container.appendChild(div); 
            }); 
        }

        function renderHOF() { 
            const container = document.getElementById('hofContent'); 
            let players = [];
            let seasonName = "";
            let targetHistory = [];
            let isCurrentSeason = false;
            
            if (viewHofSeason === activeSeason) { 
                isCurrentSeason = true;
                seasonName = activeSeason + " (ì§„í–‰ì¤‘)";
                players = rankingsData.filter(p => (Number(p.wins || 0) + Number(p.losses || 0)) > 0);
                targetHistory = matchHistoryData.filter(m => m.season === activeSeason && m.type !== 'draw');
            } else { 
                const arc = seasonArchives[viewHofSeason]; 
                if (arc) { 
                    seasonName = viewHofSeason;
                    players = (arc.rankings || []).filter(p => (Number(p.wins || 0) + Number(p.losses || 0)) > 0);
                    targetHistory = matchHistoryData.filter(m => m.season === viewHofSeason && m.type !== 'draw');
                } 
            } 
            
            if (players.length === 0 && !isCurrentSeason) { 
                container.innerHTML = `<div class="text-center py-20 text-slate-400 flex flex-col items-center gap-2"><span class="text-4xl grayscale opacity-50">ğŸ†</span><span>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span></div>`; 
                return; 
            } 

            const historyWithIndex = targetHistory.map((m, i) => ({ ...m, originalIndex: i }));
            const sortedHistory = historyWithIndex.sort((a, b) => {
                const dateA = new Date(a.date).getTime();
                const dateB = new Date(b.date).getTime();
                if (dateA !== dateB) return dateA - dateB;
                return b.originalIndex - a.originalIndex;
            });

            const streakMap = {}; 
            sortedHistory.forEach(m => {
                const w = m.winner.trim();
                const l = m.loser.trim();
                if (!streakMap[w]) streakMap[w] = { current: 0, max: 0 };
                streakMap[w].current += 1;
                if (streakMap[w].current > streakMap[w].max) streakMap[w].max = streakMap[w].current;
                if (!streakMap[l]) streakMap[l] = { current: 0, max: 0 };
                streakMap[l].current = 0;
            });
            
            const playersWithStreak = players.map(p => {
                return { ...p, maxStreak: (streakMap[p.name.trim()] ? streakMap[p.name.trim()].max : 0) };
            });

            let championList = [];
            let champTitle = "ì‹œì¦Œ ë­í‚¹ TOP 3";
            let champSub = "ìµœì¢… ìˆœìœ„";

            if (isCurrentSeason) {
                const pastSeasons = Object.keys(seasonArchives).sort((a, b) => b.localeCompare(a, undefined, { numeric: true, sensitivity: 'base' }));
                if (pastSeasons.length > 0) {
                    const prevName = pastSeasons[0];
                    const prevData = seasonArchives[prevName].rankings || [];
                    championList = prevData.filter(p => (p.wins + p.losses) >= 3)
                                                                    .sort((a, b) => (b.elo || 1000) - (a.elo || 1000))
                                                                    .slice(0, 3);
                    champTitle = "ì „ì‹œì¦Œ TOP 3";
                    champSub = `${prevName} ë ˆì „ë“œ`;
                }
            } else {
                championList = players.filter(p => (p.wins + p.losses) >= 3)
                                                                 .sort((a, b) => (b.elo || 1000) - (a.elo || 1000))
                                                                 .slice(0, 3);
            }

            const ironWillList = [...players].sort((a, b) => {
                const totalA = a.wins + a.losses;
                const totalB = b.wins + b.losses;
                if (totalA !== totalB) return totalB - totalA;
                return (b.elo || 1000) - (a.elo || 1000);
            }).slice(0, 3);

            const conquerorList = [...players].sort((a, b) => {
                if (a.wins !== b.wins) return b.wins - a.wins;
                return (b.elo || 1000) - (a.elo || 1000);
            }).slice(0, 3);

            const streakList = [...playersWithStreak].sort((a, b) => {
                if (a.maxStreak !== b.maxStreak) return b.maxStreak - a.maxStreak;
                return (b.elo || 1000) - (a.elo || 1000);
            }).filter(p => p.maxStreak > 0).slice(0, 3);


            const createPodiumSection = (title, sub, icon, list, colorFrom, colorTo, type) => {
                if (!list || list.length === 0) return ''; 

                const p1 = list[0];
                const p2 = list[1] || null;
                const p3 = list[2] || null;

                const getValue = (p) => {
                    if (type === 'elo') return `âš¡${p.elo}`;
                    if (type === 'match') return `${p.wins+p.losses}ì „`;
                    if (type === 'win') return `${p.wins}ìŠ¹`;
                    if (type === 'streak') return `${p.maxStreak}ì—°ìŠ¹`;
                    return '';
                };

                const renderPodiumItem = (p, rank) => {
                    if (!p) return `<div class="flex-1 w-full opacity-0"></div>`;
                    
                    const is1st = rank === 1;
                    const order = is1st ? "order-2 z-10 -mt-4 sm:-mt-6" : (rank === 2 ? "order-1" : "order-3");
                    
                    const imgSizeClass = is1st ? "w-[85px] h-[85px] sm:w-[120px] sm:h-[120px]" : "w-[70px] h-[70px] sm:w-[100px] sm:h-[100px]";
                    const imgBorder = is1st ? "border-2 border-amber-400 shadow-xl" : "border border-slate-200 shadow-md";
                    
                    const badgeClass = is1st ? "bg-gradient-to-r from-amber-500 to-orange-500 text-white" : (rank === 2 ? "bg-slate-700 text-white" : "bg-orange-700 text-white");
                    const badgeText = rank + "ìœ„";
                    const badgeSize = is1st ? "text-[10px] sm:text-xs" : "text-[10px] sm:text-[11px]";
                    
                    const crown = '';
                    
                    const plateHeight = is1st ? "h-16 sm:h-20" : "h-14 sm:h-16";
                    const plateBg = is1st ? "bg-gradient-to-b from-amber-100 to-amber-50 border border-amber-200 text-amber-900" : "bg-slate-50 border border-slate-200 text-slate-700";
                    
                    const nameSize = is1st ? "text-sm sm:text-[20px]" : "text-xs sm:text-base";
                    const statColor = is1st ? "text-amber-600" : "text-slate-400";
                    const statSize = is1st ? "text-[10px] sm:text-[14px]" : "text-[10px] sm:text-xs";

                    return `
                        <div class="flex-1 w-full flex flex-col items-center justify-end ${order}">
                             <div class="relative flex flex-col items-center cursor-pointer group w-full" onclick="openProfile('${p.id}')">
                                <div class="relative z-20 mb-2 transition-transform group-hover:scale-110 flex justify-center">
                                    ${crown}
                                    <img src="${p.imageUrl || 'https://placehold.co/150?text=No+Img'}" class="${imgSizeClass} rounded-2xl object-cover ${imgBorder} bg-slate-200" onerror="this.src='https://placehold.co/150?text=No+Img'">
                                    <div class="absolute -top-2 -left-2 ${badgeSize} shadow-sm ${badgeClass} font-bold rounded-lg px-2 py-0.5 border border-white z-30">${badgeText}</div>
                                </div>
                                <div class="${plateHeight} w-full ${plateBg} rounded-lg flex flex-col items-center justify-center shadow-sm">
                                    <div class="font-black ${nameSize} truncate w-full text-center px-1 leading-tight">${p.name}</div>
                                    <div class="${statColor} ${statSize} font-bold mt-0.5 sm:mt-1">${getValue(p)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                };

                return `
                    <div class="bg-white rounded-2xl p-3 sm:p-4 shadow-sm border border-slate-100 mb-6 relative overflow-hidden fade-in">
                        <div class="flex items-center gap-2 sm:gap-3 mb-4 sm:mb-6 border-b border-slate-100 pb-2 sm:pb-3">
                            <span class="text-xl sm:text-2xl">${icon}</span>
                            <div>
                                <div class="text-sm sm:text-base font-black text-slate-800 tracking-tight leading-none">${title}</div>
                                <div class="text-[10px] sm:text-xs text-slate-400 font-medium mt-0.5 sm:mt-1">${sub}</div>
                            </div>
                        </div>
                        <div class="flex justify-center items-end gap-2 px-2 h-auto pt-4 pb-2">
                            ${renderPodiumItem(p2, 2)}
                            ${renderPodiumItem(p1, 1)}
                            ${renderPodiumItem(p3, 3)}
                        </div>
                    </div>
                `; 
            };

            container.innerHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-xl font-black text-slate-800 tracking-tight">${seasonName}</h3>
                    <p class="text-xs text-slate-400 mt-1 uppercase tracking-widest">Season Awards Podium</p>
                </div>
                
                <div class="px-1 pb-10">
                    ${createPodiumSection("ìµœë‹¤ ì—°ìŠ¹", "ë©ˆì¶œ ìˆ˜ ì—†ëŠ” ê¸°ì„¸", "ğŸš€", streakList, "rose-400", "pink-500", "streak")}
                    ${createPodiumSection("ìµœë‹¤ í”Œë ˆì´", "ì§€ì¹˜ì§€ ì•ŠëŠ” ì—´ì •", "ğŸ”¥", ironWillList, "slate-500", "slate-700", "match")}
                    ${createPodiumSection("ìµœë‹¤ìŠ¹", "ì••ë„ì ì¸ ìŠ¹ë¦¬", "âš”ï¸", conquerorList, "blue-500", "indigo-600", "win")}
                    ${createPodiumSection(champTitle, champSub, "ğŸ‘‘", championList, "amber-400", "orange-500", "elo")}
                </div>
            `; 
        }
        
        window.openProfile = (id) => { 
            currentProfileId = id; 
            const p = rankingsData.find(x => x.id === id); 
            if (!p) return; 
            document.getElementById('pModalName').textContent = p.name; 
            document.getElementById('pModalCrown').classList.toggle('hidden', !p.isChampion); 
            document.getElementById('pModalGameId').textContent = `ID: ${p.gameId || '-'}`; 
            document.getElementById('pModalImg').src = p.imageUrl || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23cbd5e1' stroke-width='2'%3E%3Ccircle cx='12' cy='8' r='5'/%3E%3Cpath d='M20 21a8 8 0 0 0-16 0'/%3E%3C/svg%3E"; 
            
            const filterEl = document.getElementById('pModalSeason'); 
            filterEl.innerHTML = '<option value="all">ì „ì²´ ê¸°ë¡ (All Time)</option><option value="current">í˜„ì¬ ì‹œì¦Œ (Current)</option>'; 
            Object.keys(seasonArchives).sort().reverse().forEach(s => { filterEl.innerHTML += `<option value="${s}">${s}</option>`; }); 
            
            filterEl.value = 'all'; 
            filterEl.onchange = (e) => updateProfileStats(id, e.target.value); 
            
            const tier = getTier(p.wins, p.losses, p.elo, p.isChampion);            
            const tierEl = document.getElementById('pModalTierBadge'); 
            tierEl.textContent = tier.name; 
            tierEl.className = `text-[10px] font-bold px-2 py-0.5 rounded shadow-sm ${tier.color}`; 
            
            document.getElementById('pModalHeight').textContent = p.height ? p.height + 'cm' : '-'; 
            document.getElementById('pModalReach').textContent = p.reach ? p.reach + 'cm' : '-'; 
            document.getElementById('pModalStance').textContent = p.stance || '-'; 
            
            const tagsContainer = document.getElementById('pModalTags'); 
            tagsContainer.innerHTML = ''; 
            (p.tags || []).forEach(tag => { tagsContainer.innerHTML += `<span class="text-[10px] font-bold text-slate-500 bg-slate-100 px-3 py-1 rounded-full border border-slate-200">#${tag}</span>`; }); 
            
            updateProfileStats(id, 'all'); 
            document.getElementById('profileModal').classList.remove('hidden'); 
        };
        window.closeProfile = () => { document.getElementById('profileModal').classList.add('hidden'); }
        
        window.updateProfileStats = (id, filter) => { 
            const p = rankingsData.find(x => x.id === id); 
            if (!p) return; 
            let matches = enrichedMatchHistory.filter(m => (m.winner === p.name || m.loser === p.name) && m.type !== 'draw'); 
            if (filter === 'current') matches = matches.filter(m => m.season === activeSeason); 
            else if (filter !== 'all') matches = matches.filter(m => m.season === filter); 
            matches.sort((a, b) => new Date(b.date) - new Date(a.date)); 
            
            let wins = 0, losses = 0; 
            matches.forEach(m => { if (m.winner === p.name) wins++; else losses++; }); 
            const total = wins + losses; 
            const winRate = total > 0 ? Math.round((wins / total) * 100) : 0; 
            
            document.getElementById('pBigWins').textContent = wins; 
            document.getElementById('pBigLosses').textContent = losses; 
            document.getElementById('pModalWinRate').textContent = `${winRate}%`; 
            document.getElementById('pModalElo').textContent = p.elo || 1000; 
            document.getElementById('pModalHighElo').textContent = p.careerHighElo || p.elo || 1000; 
            
            const container = document.getElementById('pModalMatchList'); 
            container.innerHTML = ''; 
            
            if (matches.length === 0) { 
                container.innerHTML = `<div class="text-center text-xs text-slate-400 py-4">í•´ë‹¹ ê¸°ê°„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>`; 
                return; 
            } 
            
            matches.forEach(m => { 
                const isWin = m.winner === p.name; 
                const resultText = isWin ? 'W' : 'L'; 
                const resultColor = isWin ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'; 
                const oppName = isWin ? m.loser : m.winner; 
                const oppStats = m.snapshot[filter === 'all' ? 'all' : 'season'][oppName] || { w:0, l:0, h:[] }; 
                const oppRecordStr = `${oppStats.w}ìŠ¹ ${oppStats.l}íŒ¨`; 
                
                let oppDots = ''; 
                (oppStats.h || []).forEach(res => { 
                    if (res === 'W') oppDots += `<div class="w-1 h-1 rounded-full bg-emerald-400"></div>`; 
                    else oppDots += `<div class="w-1 h-1 rounded-full bg-rose-400"></div>`; 
                }); 
                
                let scoreBadge = ''; 
                if (isWin && m.winnerChange !== undefined) { 
                    scoreBadge = `<span class="text-[13px] font-black text-emerald-600 shrink-0">+${m.winnerChange}</span>`; 
                } else if (!isWin && m.loserChange !== undefined) { 
                    scoreBadge = `<span class="text-[13px] font-black text-rose-600 shrink-0">${m.loserChange}</span>`; 
                } 

                let oppRankBadge = '';
                const oppRankVal = isWin ? m.loserRankBefore : m.winnerRankBefore;
                if (oppRankVal !== undefined) {
                    if (oppRankVal > 0) {
                        oppRankBadge = `<span class="bg-slate-200 text-slate-500 text-[11px] px-2 py-0.5 rounded-md font-bold leading-none no-underline shadow-sm">${oppRankVal}ìœ„</span>`;
                    } else {
                        oppRankBadge = `<span class="bg-slate-100 text-slate-400 text-[11px] px-2 py-0.5 rounded-md font-bold leading-none no-underline shadow-sm border border-slate-200">ë°°ì¹˜ì¤‘</span>`;
                    }
                } else {
                    oppRankBadge = `<span class="bg-slate-100 text-slate-400 text-[11px] px-2 py-0.5 rounded-md font-bold leading-none no-underline shadow-sm border border-slate-200" title="ê³¼ê±° ê¸°ë¡">-</span>`;
                }

                const oppProfile = rankingsData.find(u => u.name === oppName);
                const oppLink = oppProfile ? `onclick="openProfile('${oppProfile.id}')"` : '';
                const oppCursor = oppProfile ? 'cursor-pointer hover:underline hover:text-blue-600' : '';

                const div = document.createElement('div'); 
                div.className = "flex items-center justify-between text-xs p-3 bg-slate-50 rounded-xl border border-slate-100"; 
                div.innerHTML = `<div class="flex items-center gap-3 w-full"><div class="flex items-center gap-1.5 shrink-0"><span class="font-bold ${resultColor} w-8 h-8 flex items-center justify-center rounded-lg text-sm shadow-sm">${resultText}</span>${scoreBadge}</div><div class="flex flex-col w-full overflow-hidden"><div class="flex justify-between items-center w-full"><span class="font-bold text-slate-700 text-sm truncate flex items-center gap-1.5 ${oppCursor}" ${oppLink}>vs ${oppName}${oppRankBadge}</span><span class="text-slate-900 font-medium text-[11px] shrink-0">${m.date}</span></div><div class="flex items-center gap-2 mt-0.5"><span class="text-[11px] text-slate-400 font-medium bg-white px-1.5 py-0.5 rounded border border-slate-100">ë‹¹ì‹œ: ${oppRecordStr}</span><div class="flex gap-0.5">${oppDots}</div></div></div></div>`; 
                container.appendChild(div); 
            }); 
        };

        window.openRules = () => document.getElementById('rulesModal').classList.remove('hidden'); window.closeRules = () => document.getElementById('rulesModal').classList.add('hidden');
        window.switchTab = (tab) => { ['ranking', 'matches', 'hof', 'tournament'].forEach(t => { document.getElementById(t + 'Section').classList.add('hidden'); const btn = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1)); btn.className = "tab-inactive flex-1 py-3 text-sm transition-colors text-center"; }); document.getElementById(tab + 'Section').classList.remove('hidden'); const activeBtn = document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)); activeBtn.className = "tab-active flex-1 py-3 text-sm transition-colors text-center"; };

        let editTargetId = null;
        window.requestEdit = () => { if (!currentProfileId) return; editTargetId = currentProfileId; document.getElementById('inputPin').value = ''; document.getElementById('pinModal').classList.remove('hidden'); document.getElementById('inputPin').focus(); };
        window.closePinModal = () => document.getElementById('pinModal').classList.add('hidden');
        window.checkPin = async () => { 
            const input = document.getElementById('inputPin').value; 
            const p = rankingsData.find(x => x.id === editTargetId); 
            const userPin = p.password || "0000"; 
            let isMatch = false;
            if (userPin.length === 4) { if (input === userPin) isMatch = true; } 
            else { const inputHash = await hashPin(input); if (inputHash === userPin) isMatch = true; }
            if (isMatch) { closePinModal(); openUserEditModal(p); } 
            else { alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); document.getElementById('inputPin').value = ''; } 
        };

        function openUserEditModal(p) {
            document.getElementById('userEditHeight').value = p.height || ''; document.getElementById('userEditReach').value = p.reach || ''; document.getElementById('userEditStance').value = p.stance || 'Orthodox'; document.getElementById('userEditGameId').value = p.gameId || ''; document.getElementById('userEditPin').value = ''; 
            document.getElementById('userImageUrlInput').value = p.imageUrl || ''; document.getElementById('userEditPreview').src = p.imageUrl || 'https://placehold.co/150?text=No+Img';
            const tc = p.trunkColor || '#1f2937';
            document.getElementById('userEditTrunkColor').value = tc;
            document.querySelectorAll('#userEditModal .color-preset').forEach(el => {
                const presetColor = el.dataset.color;
                if((presetColor && presetColor.toLowerCase() === tc.toLowerCase()) || el.style.backgroundColor === tc || (tc.toUpperCase() === el.style.backgroundColor.toUpperCase())) { el.classList.add('active'); } 
                else { el.classList.remove('active'); }
            });
            const container = document.getElementById('userStyleTags'); container.innerHTML = ''; 
            STYLE_OPTIONS.forEach(s => { const safeId = `u-style-${s.replace(/\s+/g, '-')}`; const checked = (p.tags || []).includes(s); container.innerHTML += `<div><input type="checkbox" id="${safeId}" value="${s}" class="style-checkbox absolute opacity-0 w-0 h-0" ${checked ? 'checked' : ''}><label for="${safeId}" class="inline-block px-3 py-1 text-xs font-bold border border-slate-300 rounded-full cursor-pointer text-slate-500 hover:bg-slate-100 transition select-none">${s}</label></div>`; });
            document.getElementById('userEditModal').classList.remove('hidden');
        }

        window.closeUserEdit = () => document.getElementById('userEditModal').classList.add('hidden');
        window.updateUserPreview = (url) => { document.getElementById('userEditPreview').src = url || 'https://placehold.co/150?text=No+Img'; };
        window.saveUserProfile = async () => {
            if (!editTargetId) return;
            const newHeight = document.getElementById('userEditHeight').value.replace(/</g, "&lt;");
            const newReach = document.getElementById('userEditReach').value.replace(/</g, "&lt;");
            const newStance = document.getElementById('userEditStance').value;
            const newGameId = document.getElementById('userEditGameId').value.replace(/</g, "&lt;");
            const newImageUrl = document.getElementById('userImageUrlInput').value.trim().replace(/</g, "&lt;");
            const newTrunkColor = document.getElementById('userEditTrunkColor').value;
            const inputPin = document.getElementById('userEditPin').value;
            const checkedTags = document.querySelectorAll('#userStyleTags .style-checkbox:checked'); 
            const newTags = Array.from(checkedTags).map(cb => cb.value).slice(0, 3);
            let newPassword = null;
            if (inputPin && inputPin.length === 4) { newPassword = await hashPin(inputPin); }
            try {
                await runTransaction(db, async (transaction) => {
                    const sfDoc = await transaction.get(docRef);
                    if (!sfDoc.exists()) throw "Doc missing";
                    const data = sfDoc.data();
                    const rankings = data.rankings || [];
                    const idx = rankings.findIndex(r => r.id === editTargetId);
                    if (idx === -1) throw "User not found";
                    
                    // ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸
                    rankings[idx].height = newHeight; rankings[idx].reach = newReach; rankings[idx].stance = newStance; rankings[idx].gameId = newGameId; rankings[idx].imageUrl = newImageUrl; rankings[idx].trunkColor = newTrunkColor; rankings[idx].tags = newTags;
                    if (newPassword) rankings[idx].password = newPassword;

                    // [Data Integrity] 11ìœ„ ì´í•˜ í˜„ìƒê¸ˆ ì‚­ì œ ë¡œì§ (ì‚¬ìš©ì ë°ì´í„° ë³´ì •)
                    const challengers = rankings.filter(p => !p.isChampion && (Number(p.wins||0) + Number(p.losses||0)) >= 3)
                                                .sort((a, b) => (b.elo || 1000) - (a.elo || 1000));
                    
                    const myRank = challengers.findIndex(p => p.id === editTargetId) + 1;
                    
                    // 11ìœ„ ì´í•˜(Rank > 10)ì´ê³  í˜„ìƒê¸ˆì´ ìˆë‹¤ë©´ ì‚­ì œ
                    if (myRank > 10 && (rankings[idx].bounty || 0) > 0) {
                        rankings[idx].bounty = 0;
                    }

                    transaction.update(docRef, { rankings: rankings });
                });
                alert("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤."); closeUserEdit(); if (currentProfileId === editTargetId) openProfile(currentProfileId);
            } catch (e) { console.error(e); alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."); }
        };
    </script>
</body>
</html>


